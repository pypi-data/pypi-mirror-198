{"version":3,"sources":["create-plugin-ui.js","Molstar.jsx","MolstarComponent.tsx","index.tsx"],"names":["i","createPluginUI","target","spec","options","ctx","PluginUIContext","DefaultPluginUISpec","init","onBeforeUIRender","ReactDOM","render","createElement","Plugin","plugin","canvas3dInitialized","CustomMaterial","Material","roughness","metalness","PresetParams","StructureRepresentationPresetProvider","CommonParams","addTrajectory","params","model","kind","builders","data","rawData","label","modelLabel","download","url","isBinary","structure","parseTrajectory","format","trajectory","createModel","provider","dataFormats","get","parse","coordinates","coordinatesLabel","coords","build","toRoot","apply","TrajectoryFromModelAndCoordinates","modelRef","ref","coordinatesRef","dependsOn","StateTransforms","Model","ModelFromTrajectory","modelIndex","commit","createStructure","representation","applyPreset","InteractionsPreset","id","display","name","structureCell","StateObjectRef","resolveAndCheck","state","obj","presetStaticComponent","components","ligand","interactions","reprBuilder","update","builder","typeParams","representations","buildRepresentation","type","material","sizeFactor","color","colorParams","carbonColor","tag","ballAndStick","surroundings","sizeAspectRatio","InteractionsRepresentationProvider","includeParent","parentDisplay","InteractionTypeColorThemeProvider","background","borderWidth","value","Color","revertOnError","managers","interactivity","setProps","granularity","ViewerAutoPreset","group","description","isApplicable","a","models","some","m","QualityAssessment","sourceData","QualityAssessmentPLDDTPreset","QualityAssessmentQmeanPreset","PresetStructureRepresentations","auto","Molstar","props","modelFile","trajFile","height","width","showAxes","defaultShowControls","showExpand","showControls","showSettings","showSelectionMode","showAnimation","showTrajectoryControls","parentRef","useRef","useEffect","layout","initial","isExpanded","controlsDisplay","config","PluginConfig","Viewport","ShowExpand","ShowControls","ShowSettings","ShowSelectionMode","ShowAnimation","Structure","DefaultRepresentationPreset","ShowTrajectoryControls","current","registerPreset","canvas3d","camera","helper","axes","loadStructure","ParamDefinition","getDefaultValues","CameraHelperParams","clear","undefined","preset","asset","Asset","File","runTask","applyAction","OpenFiles","files","visuals","isGhost","style","position","overflow","left","top","right","bottom","MyFullScreen","handler","useFullScreenHandle","className","onClick","enter","handle","children","MolstarComponent","args","StreamlitComponentBase","withStreamlitConnection","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.bbae2d37.chunk.js","sourcesContent":["import { createElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Plugin } from 'molstar/lib/mol-plugin-ui/plugin';\nimport { PluginUIContext } from 'molstar/lib/mol-plugin-ui/context';\nimport { DefaultPluginUISpec } from 'molstar/lib/mol-plugin-ui/spec';\n\nconst createPluginUI = async (target, spec, options) => {\n  const ctx = new PluginUIContext(spec || DefaultPluginUISpec());\n  await ctx.init();\n  if (options && options.onBeforeUIRender) {\n    await options.onBeforeUIRender(ctx);\n  }\n  ReactDOM.render(createElement(Plugin, { plugin: ctx }), target);\n  try {\n    await ctx.canvas3dInitialized;\n  } catch {\n    // Error reported in UI/console elsewhere.\n  }\n  return ctx;\n};\n\nexport { createPluginUI };","import React, { useEffect, useRef } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { DefaultPluginUISpec } from \"molstar/lib/mol-plugin-ui/spec\";\nimport { QualityAssessmentPLDDTPreset, QualityAssessmentQmeanPreset } from 'molstar/lib/extensions/model-archive/quality-assessment/behavior';\nimport { QualityAssessment } from 'molstar/lib/extensions/model-archive/quality-assessment/prop';\nimport { TrajectoryFromModelAndCoordinates } from 'molstar/lib/mol-plugin-state/transforms/model';\nimport { StateTransforms } from 'molstar/lib/mol-plugin-state/transforms';\nimport { PluginConfig } from \"molstar/lib/mol-plugin/config\";\nimport \"molstar/build/viewer/molstar.css\";\nimport { ParamDefinition } from \"molstar/lib/mol-util/param-definition\";\nimport { CameraHelperParams } from \"molstar/lib/mol-canvas3d/helper/camera-helper\";\nimport { OpenFiles } from 'molstar/lib/mol-plugin-state/actions/file';\nimport { Asset } from 'molstar/lib/mol-util/assets';\nimport { PresetStructureRepresentations, StructureRepresentationPresetProvider } from 'molstar/lib/mol-plugin-state/builder/structure/representation-preset';\nimport { StateObjectRef } from 'molstar/lib/mol-state';\nimport { presetStaticComponent } from 'molstar/lib/mol-plugin-state/builder/structure/representation-preset';\n\nimport { Material } from 'molstar/lib/mol-util/material';\nimport { InteractionsRepresentationProvider } from 'molstar/lib/mol-model-props/computed/representations/interactions';\nimport { InteractionTypeColorThemeProvider } from 'molstar/lib/mol-model-props/computed/themes/interaction-type';\nimport { Color } from 'molstar/lib/mol-util/color';\n\n\nimport { createPluginUI } from './create-plugin-ui';\nconst CustomMaterial = Material({ roughness: 0.2, metalness: 0 });\nconst PresetParams = {\n  ...StructureRepresentationPresetProvider.CommonParams,\n};\n\n\nexport const addTrajectory = async (plugin, params) => {\n  if (!plugin) return;\n  let model;\n  let coords;\n  if (params.model.kind === 'model-data' || params.model.kind === 'model-url') {\n    const data =\n      params.model.kind === 'model-data'\n        ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n        : await plugin.builders.data.download({\n          url: params.model.url,\n          isBinary: params.model.isBinary,\n          label: params.modelLabel,\n        });\n\n    const trajectory = await plugin.builders.structure.parseTrajectory(data, params.model.format ?? 'mmcif');\n    model = await plugin.builders.structure.createModel(trajectory);\n  } else {\n    const data =\n      params.model.kind === 'topology-data'\n        ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n        : await plugin.builders.data.download({\n          url: params.model.url,\n          isBinary: params.model.isBinary,\n          label: params.modelLabel,\n        });\n\n    const provider = plugin.dataFormats.get(params.model.format);\n    model = await provider.parse(plugin, data);\n  }\n  {\n    const data =\n      params.coordinates.kind === 'coordinates-data'\n        ? await plugin.builders.data.rawData({\n          data: params.coordinates.data,\n          label: params.coordinatesLabel,\n        })\n        : await plugin.builders.data.download({\n          url: params.coordinates.url,\n          isBinary: params.coordinates.isBinary,\n          label: params.coordinatesLabel,\n        });\n\n    const provider = plugin.dataFormats.get(params.coordinates.format);\n    coords = await provider.parse(plugin, data);\n  }\n  const trajectory = await plugin\n    .build()\n    .toRoot()\n    .apply(\n      TrajectoryFromModelAndCoordinates,\n      {\n        modelRef: model.ref,\n        coordinatesRef: coords.ref,\n      },\n      { dependsOn: [model.ref, coords.ref] }\n    )\n    .apply(StateTransforms.Model.ModelFromTrajectory, { modelIndex: 0 })\n    .commit();\n  const structure = await plugin.builders.structure.createStructure(trajectory);\n  await plugin.builders.structure.representation.applyPreset(structure, 'auto');\n};\n\n\n\n\nconst InteractionsPreset = StructureRepresentationPresetProvider({\n  id: 'preset-interactions',\n  display: { name: 'Interactions' },\n  params: () => PresetParams,\n  async apply(ref, params, plugin) {\n      const structureCell = StateObjectRef.resolveAndCheck(plugin.state.data, ref);\n      const structure = structureCell?.obj?.data;\n      if (!structureCell || !structure) return {};\n\n      const components = {\n          ligand: await presetStaticComponent(plugin, structureCell, 'all'),\n          interactions: await presetStaticComponent(plugin, structureCell, 'all'),\n      };\n\n      const { update, builder, typeParams } = StructureRepresentationPresetProvider.reprBuilder(plugin, params);\n      const representations = {\n          ligand: builder.buildRepresentation(update, components.ligand, { type: 'ball-and-stick', typeParams: { ...typeParams, material: CustomMaterial, sizeFactor: 0.3 }, color: 'element-symbol', colorParams: { carbonColor: { name: 'element-symbol', params: {} } } }, { tag: 'all' }),\n          ballAndStick: builder.buildRepresentation(update, components.surroundings, { type: 'ball-and-stick', typeParams: { ...typeParams, material: CustomMaterial, sizeFactor: 0.1, sizeAspectRatio: 1 }, color: 'element-symbol', colorParams: { carbonColor: { name: 'element-symbol', params: {} } } }, { tag: 'ball-and-stick' }),\n          interactions: builder.buildRepresentation(update, components.interactions, { type: InteractionsRepresentationProvider, typeParams: { ...typeParams, material: CustomMaterial, includeParent: true, parentDisplay: 'between' }, color: InteractionTypeColorThemeProvider }, { tag: 'interactions' }),\n          label: builder.buildRepresentation(update, components.surroundings, { type: 'label', typeParams: { ...typeParams, material: CustomMaterial, background: false, borderWidth: 0.1 }, color: 'uniform', colorParams: { value: Color(0x000000) } }, { tag: 'label' }),\n      };\n\n      await update.commit({ revertOnError: true });\n      plugin.managers.interactivity.setProps({ granularity: 'element' });\n\n      return { components, representations };\n  }\n});\n\nconst ViewerAutoPreset = StructureRepresentationPresetProvider({\n  id: 'preset-structure-representation-viewer-auto',\n  display: {\n    name: 'Automatic (w/ Annotation)', group: 'Annotation',\n    description: 'Show standard automatic representation but colored by quality assessment (if available in the model).'\n  },\n  isApplicable(a) {\n    return (\n      !!a.data.models.some(m => QualityAssessment.isApplicable(m, 'pLDDT')) ||\n      !!a.data.models.some(m => QualityAssessment.isApplicable(m, 'qmean'))\n    );\n  },\n  params: () => StructureRepresentationPresetProvider.CommonParams,\n  async apply(ref, params, plugin) {\n    const structureCell = StateObjectRef.resolveAndCheck(plugin.state.data, ref);\n    const structure = structureCell && structureCell.obj && structureCell.obj.data;\n    if (!structureCell || !structure) return {};\n    \n    if (structure.model.sourceData.kind === 'gro'){\n      return await InteractionsPreset.apply(ref, params, plugin);\n      \n    } else if (structure.models.some(m => QualityAssessment.isApplicable(m, 'pLDDT'))) {\n      return await QualityAssessmentPLDDTPreset.apply(ref, params, plugin);\n    } else if (structure.models.some(m => QualityAssessment.isApplicable(m, 'qmean'))) {\n      return await QualityAssessmentQmeanPreset.apply(ref, params, plugin);\n    } else {\n      return await PresetStructureRepresentations.auto.apply(ref, params, plugin);\n    }\n  }\n});\n\n\nconst Molstar = props => {\n\n  const {\n    modelFile, trajFile,\n    height = '100%', width = '100%',\n    showAxes = true,\n    defaultShowControls = false,\n    showExpand = true, showControls = true, showSettings = true, showSelectionMode = true, showAnimation = false, showTrajectoryControls = true\n  } = props;\n  const parentRef = useRef(null);\n  const canvasRef = useRef(null);\n  const plugin = useRef(null);\n\n  useEffect(() => {\n    (async () => {\n      const spec = DefaultPluginUISpec();\n      spec.layout = {\n        initial: {\n          isExpanded: false,\n          controlsDisplay: \"reactive\",\n          showControls: defaultShowControls,\n        },\n      };\n      spec.config = [\n        [PluginConfig.Viewport.ShowExpand, showExpand],\n        [PluginConfig.Viewport.ShowControls, showControls],\n        [PluginConfig.Viewport.ShowSettings, showSettings],\n        [PluginConfig.Viewport.ShowSelectionMode, showSelectionMode],\n        [PluginConfig.Viewport.ShowAnimation, showAnimation],\n        [PluginConfig.Structure.DefaultRepresentationPreset, ViewerAutoPreset.id],\n        [PluginConfig.Viewport.ShowTrajectoryControls, showTrajectoryControls],\n      ];\n      plugin.current = await createPluginUI(parentRef.current, spec, {\n        onBeforeUIRender: plugin => {\n            // the preset needs to be added before the UI renders otherwise\n            // \"Download Structure\" wont be able to pick it up\n            plugin.builders.structure.representation.registerPreset(ViewerAutoPreset);\n        }\n    });\n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: {\n                name: \"off\", params: {}\n              }\n            }\n          }\n        });\n      }\n      await loadStructure(modelFile, trajFile, plugin.current);\n    })();\n    return () => plugin.current = null;\n  }, [])\n\n\n  useEffect(() => {\n    loadStructure(modelFile, trajFile, plugin.current);\n  }, [modelFile, trajFile])\n\n\n  useEffect(() => {\n    if (plugin.current) {\n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: {\n                name: \"off\", params: {}\n              }\n            }\n          }\n        })\n      } else {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: ParamDefinition.getDefaultValues(CameraHelperParams).axes\n            }\n          }\n        })\n      }\n    }\n  }, [showAxes])\n\n  \n\n  const loadStructure = async (modelFile, trajFile, plugin) => {\n    if (plugin) {\n      plugin.clear();\n      if (trajFile) {\n        await addTrajectory(plugin, {\n          model: {\n            kind: (modelFile.url ? 'model-url' : 'model-data'),\n            url: (modelFile.url ? modelFile.url : undefined),\n            data: (modelFile.data ? modelFile.data : undefined),\n            format: modelFile.format,\n          },\n          coordinates: {\n            kind: (trajFile.url ? 'coordinates-url' : 'coordinates-data'),\n            url: (trajFile.url ? trajFile.url : undefined),\n            data: (trajFile.data ? trajFile.data : undefined),\n            format: trajFile.format,\n            isBinary: true,\n          },\n          preset: 'all-models',\n        });\n      } else if (modelFile.data) {\n        const asset = Asset.File(new File([modelFile.data], modelFile.name));\n        // const data = await OpenFiles(plugin, {\n        //   files: [asset],\n        //    format: { name: 'auto', params: {} },\n        //    visuals: true\n        // });\n        //PluginCommands.State.Snapshots.OpenFile(plugin, { file: new File([modelFile.data], modelFile.name)});\n        plugin.runTask(plugin.state.data.applyAction(OpenFiles, {\n          files: [asset],\n           format: { name: 'auto', params: {} },\n           visuals: true\n        })); \n      } else {\n        const data = await plugin.builders.data.download(\n          { url: modelFile.url }, { state: { isGhost: true } }\n        );\n        const asset = Asset.File(new File([data.obj.data], modelFile.name));\n        plugin.runTask(plugin.state.data.applyAction(OpenFiles, {\n          files: [asset],\n            format: { name: 'auto', params: {} },\n            visuals: true\n        })); \n      }\n    }\n  }\n  return (\n    <div style={{ position: \"absolute\", width, height, overflow: \"hidden\" }}>\n      <div ref={parentRef} style={{ position: \"absolute\", left: 0, top: 0, right: 0, bottom: 0 }} />\n    </div>\n  )\n};\n\nMolstar.propTypes = {\n  modelFile: PropTypes.object,\n  trajFile: PropTypes.object,\n\n  // Viz Control\n  showAxes: PropTypes.bool,\n  showControls: PropTypes.bool,\n  showExpand: PropTypes.bool,\n  showAnimation: PropTypes.bool,\n  showSettings: PropTypes.bool,\n  showSelectionMode: PropTypes.bool,\n  showTrajectoryControls: PropTypes.bool,\n  defaultShowControls: PropTypes.bool,\n\n  // More\n  width: PropTypes.string,\n  height: PropTypes.string,\n};\n\nexport default Molstar;","import {\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React, { ReactNode } from \"react\"\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\"\n// @ts-ignore\n//import Molstar from \"molstar-react\";\nimport Molstar from \"./Molstar.jsx\"\nimport \"./MolstarComponent.css\"\n\ninterface State {}\n\nconst MyFullScreen = (props: any) => {\n  const handler = useFullScreenHandle()\n  return (\n    <>\n      <button className=\"fullscreen-button\" onClick={handler.enter}>\n        <span></span>\n        <span></span>\n        <span></span>\n        <span></span>\n      </button>\n      <FullScreen className=\"myfullscreen\" handle={handler}>\n        {props.children}\n      </FullScreen>\n    </>\n  )\n}\n\nclass MolstarComponent extends StreamlitComponentBase<State> {\n  public render = (): ReactNode => {\n    const height = this.props.args[\"height\"]\n    const modelFile = this.props.args[\"modelFile\"]\n    const trajFile = this.props.args[\"trajFile\"]\n\n    if (modelFile && modelFile.data) {\n      modelFile.data = this.props.args[\"modelFile_data\"]\n    }\n    if (trajFile && trajFile.data) {\n      trajFile.data = this.props.args[\"trajFile_data\"]\n    }\n\n    return (\n      <div style={{ height: height }}>\n        <MyFullScreen>\n          <Molstar\n            modelFile={modelFile}\n            trajFile={trajFile}\n            showExpand={false}\n            showAnimation={true}\n          />\n        </MyFullScreen>\n      </div>\n    )\n  }\n}\n\n// \"withStreamlitConnection\" is a wrapper function. It bootstraps the\n// connection between your component and the Streamlit app, and handles\n// passing arguments from Python -> Component.\n//\n// You don't need to edit withStreamlitConnection (but you're welcome to!).\nexport default withStreamlitConnection(MolstarComponent)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport MolstarComponent from \"./MolstarComponent\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <MolstarComponent />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)"],"sourceRoot":""}