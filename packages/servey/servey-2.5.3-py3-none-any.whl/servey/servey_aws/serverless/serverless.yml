service: ServeyMain
package:
  exclude:
  - aws/**
  - node_modules/**
  - venv/**
  - .venv/**
  - tests/**
provider:
  name: aws
  runtime: python3.9
  environment:
    LOG_LEVEL: INFO
    KMS_KEY_ID: serveyKmsKey
    CONNECTION_TABLE_NAME: servey_app_connection
    SERVEY_MAIN: servey_main
  iamRoleStatements:
  - ${file(serverless_servey/subscriptions_role_statement.yml):iamRoleStatements.0,
    ''}
  - ${file(serverless_servey/subscriptions_role_statement.yml):iamRoleStatements.1,
    ''}
  - ${file(serverless_servey/kms_role_statement.yml):iamRoleStatements.0, ''}
custom:
  pythonRequirements:
    useDownloadCache: false
    useStaticCache: false
    dockerizePip: true
  prune:
    automatic: true
    number: 3
  appSync:
  - ${file(serverless_servey/appsync.yml)}
plugins:
- serverless-python-requirements
- serverless-prune-plugin
- serverless-appsync-plugin
# - serverless-api-gateway-caching
functions:
- ${file(serverless_servey/actions.yml)}
- ${file(serverless_servey/subscriptions_handlers.yml)}
resources:
- ${file(serverless_servey/subscriptions_resources.yml)}
- ${file(serverless_servey/kms_resource.yml)}
