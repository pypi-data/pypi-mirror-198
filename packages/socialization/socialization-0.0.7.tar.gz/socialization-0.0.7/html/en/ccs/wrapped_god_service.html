<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>socialization.ccs.wrapped_god_service API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>socialization.ccs.wrapped_god_service</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from .base_god_service import BaseGodService
from .wrapped_goddess_db_agent import WrappedGoddessDBAgent
import rel


class WrappedGodService(BaseGodService):
    &#34;&#34;&#34;
        This is the wrapped God service.
        CCS provides a various of features for users in corresponding channels to use.
    &#34;&#34;&#34;

    def __init__(self, name=&#39;WrappedGodService&#39;):
        super().__init__()
        self.agent = WrappedGoddessDBAgent(name+&#34;.json&#34;)
        self.uri = None
        self.name = &#39;WrappedGodService&#39;
        self.feature_commands = []

        self.basic_command_func_map = {}
        self.notice_func_map = {}
        self.feature_func_map = {}

        self.prompt = {}

        self.message_func_map = {}
        
        self.temp_msg_map = {}

    def on_open(self, ws):
        &#34;&#34;&#34;
            Default behavior &#34;on_open&#34; for websocket.
            You can override this method to customize your own behavior.
            Also applies to &#34;on_message&#34;, &#34;on_error&#34; and &#34;on_close&#34;.
        &#34;&#34;&#34;
        data = {&#39;code&#39;: self.codes.COPERATION_GOD_RECONNECT, &#39;extra&#39;: {
            &#39;user_id&#39;: self.user_id, &#39;password&#39;: self.password}}
        print(&#39;SocialGodService send query: run: &#39;, data)
        self._send_ccs_operation(data, ws, None)
        print(self.name, &#39;opened&#39;)

    def add_feature(self, name, code, prompts, func=None):
        &#34;&#34;&#34;
            Add a feature to the service.
            Every feature contains a name, a code and a prompt.
            The code is always a five-digited int, and the first number must be 9, like 90001.
            The prompt here will be replaced by &#34;params&#34; in the future.
            Now it&#39;s the string that shows to the user in the input bar.
            You do not need to specify a handler func to the feature, but it&#39;s recommended to do so.
            If one feature with no handler is triggered, an exception will be raised.
            You can use set_feature_handle to set a handler for a feature.
        &#34;&#34;&#34;
        self.feature_commands.append(
            {&#39;name&#39;: name, &#39;code&#39;: code, &#39;prompts&#39;: [prompts] if prompts else []})
        self.prompt[code] = prompts
        if func:
            self.feature_func_map[code] = func

    def remove_feature(self, code):
        &#34;&#34;&#34;
            Remove a feature from the service.
            The feature is specified by its code.
        &#34;&#34;&#34;
        self.feature_commands = list(
            filter(lambda x: x[&#39;code&#39;] != code, self.feature_commands))
        self.feature_func_map.pop(code, None)

    def set_basic_command_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a basic command.
            The command is specified by its code.
            Some commands will be like &#34;help&#34;, &#34;quit&#34;.
        &#34;&#34;&#34;
        self.basic_command_func_map[code] = func

    def set_notice_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a notice.
            The notice is specified by its code.
            Some notices will be like &#34;user joined the channel&#34;, &#34;user left the channel&#34;.
        &#34;&#34;&#34;
        self.notice_func_map[code] = func

    def set_feature_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a feature.
            The feature is specified by its code.
        &#34;&#34;&#34;
        self.feature_func_map[code] = func

    def set_message_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a message.
            This code is always MESSAGE_TO_CCS.
        &#34;&#34;&#34;
        self.message_func_map[code] = func

    def _handle_data_dict(self, data, ws):
        print(
            f&#39;WrappedGodService: _handle_data_dict received {data} at websocket {ws}&#39;)
        if data[&#39;code&#39;] == self.codes.MESSAGE_TO_CCS:
            try:
                self._handle_message_to_ccs(data, ws, self.path)
            except Exception as e:
                print(&#39;WrappedGodService: _handle_message_to_ccs error: &#39;, e)
        elif data[&#39;code&#39;] == self.codes.COMMAND_TO_CCS:
            try:
                self._handle_command_to_ccs(data, ws, self.path)
            except Exception as e:
                print(&#39;WrappedGodService: _handle_command_to_ccs error: &#39;, e)
        else:
            raise Exception(&#39;no handler for code&#39;, data[&#39;code&#39;])

    def _handle_message_to_ccs(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.message_func_map:
            self.message_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no message function for code&#39;, type_code)

    def _handle_command_to_ccs(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if 20000 &lt;= type_code &lt;= 29999:
            self._handle_basic_command(data, ws, path)
        elif 80000 &lt;= type_code &lt;= 89999:
            self._handle_notice(data, ws, path)
        elif 90000 &lt;= type_code &lt;= 99999:
            self._handle_feature(data, ws, path)
        else:
            raise Exception(&#39;no command function for code&#39;, type_code)

    def _handle_basic_command(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.basic_command_func_map:
            self.basic_command_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no basic command function for code&#39;, type_code)

    def _handle_notice(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.notice_func_map:
            self.notice_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no notice function for code&#39;, type_code)

    def _handle_feature(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.feature_func_map:
            self.feature_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no feature function for code&#39;, type_code)

    def _send_ccs_operation(self, data, ws, path):
        print(&#39;WrappedGodService ccs_operation: &#39;, data)
        code = data[&#39;code&#39;]
        password = data[&#39;extra&#39;][&#39;password&#39;]
        user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
        if code == self.codes.COPERATION_GOD_RECONNECT:
            self._send_data_to_ws(
                ws, self.codes.COPERATION_GOD_RECONNECT, user_id=user_id, password=password)
        else:
            raise Exception(&#39;no ccs operation for code&#39;, code)

    def _send_command_down(self, ws, type_code, **kwargs):
        self._send_data_to_ws(ws, self.codes.COMMAND_FROM_CCS,
                              type_code=type_code, **kwargs)

    def _send_message_down(self, ws, type_code, channel_id, to_user_ids, origin, **kwargs):
        self._send_data_to_ws(ws, self.codes.MESSAGE_FROM_CCS,
                              type_code=type_code, channel_id=channel_id, to_user_ids=to_user_ids,
                              origin=origin, **kwargs)

    def broadcast_command_text(self, data, ws, text, clear=False):
        &#34;&#34;&#34;
            Broadcast a text to all users in a channel.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=self.agent.get_channel_user_list(channel_id),
            args={&#39;text&#39;: text, &#39;clear&#39;: clear}
        )

    def broadcast_command_image(self, data, ws, url):
        &#34;&#34;&#34;
            Broadcast an image to all users in a channel.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
            channel_id=channel_id,
            to_user_ids=self.agent.get_channel_user_list(channel_id),
            args={
                &#39;type&#39;: &#39;url&#39;,
                &#39;image&#39;: url
            }
        )

    def reply_command_text(self, data, ws, text, clear=False):
        &#34;&#34;&#34;
            Reply a text to a single user.
        &#34;&#34;&#34;
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;text&#39;: text, &#39;clear&#39;: clear}
        )

    def reply_command_image(self, data, ws, url):
        &#34;&#34;&#34;
            Reply an image to a single user.
        &#34;&#34;&#34;
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
            channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;type&#39;: &#39;url&#39;,  &#39;image&#39;: url}
        )

    def whistle_sender_command_text(
        self, data, ws, *,
        text_to_sender, text_to_others,
        clear_sender=False, clear_others=False
    ):
        &#34;&#34;&#34;
            Dog whistle.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        # to sender
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;text&#39;: text_to_sender, &#39;clear&#39;: clear_sender}
        )
        # to others
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=list(set(self.agent.get_channel_user_list(
                channel_id)) - {data[&#39;extra&#39;][&#39;user_id&#39;]}),
            args={&#39;text&#39;: text_to_others, &#39;clear&#39;: clear_others}
        )

    def set_account(self, user_id, password):
        &#34;&#34;&#34;
            Set the account for the service.
            Fetch these in CH0000.
        &#34;&#34;&#34;
        self.user_id = user_id
        self.password = password

    def run(self):
        &#34;&#34;&#34;
            Run the service.
        &#34;&#34;&#34;
        uri = &#39;wss://frog.4fun.chat/social&#39; if self.uri is None else self.uri
        ws = self.create_connection(
            uri, self.on_open, self.on_message, self.on_error, self.on_close)

        rel.signal(2, rel.abort)  # Keyboard Interrupt, one for all connections
        rel.dispatch()


def handle_fetch_command(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;fetch command&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=channel_id, to_user_ids=[user_id], commands=self.feature_commands)


def handle_fetch_user_list(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;fetch user list&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.join_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)


def handle_fetch_recipient_list(self, data, ws, path):
    pass


def handle_receive_user_list(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;get user list&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_ids = data[&#39;extra&#39;][&#39;user_ids&#39;]
    self.agent.init_user_id_list(channel_id, user_ids)


def handle_join(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;user join&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.join_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=channel_id, to_user_ids=[user_id], commands=self.feature_commands)


def handle_left(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;user leave&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.leave_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)


def handle_notice_take_over(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;take over channel&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    print(&#34;NOTICE_TAKE_OVER\n&#34;, data)
    target_channel_id = data[&#39;extra&#39;][&#39;target_channel_id&#39;]
    # target_channel_name = data[&#39;extra&#39;][&#39;target_channel_name&#39;]
    user_ids = data[&#34;extra&#34;][&#34;target_user_ids&#34;]
    self.agent.init_user_id_list(target_channel_id, user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=target_channel_id, to_user_ids=user_ids, user_ids=user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=target_channel_id, to_user_ids=user_ids, user_ids=user_ids, commands=self.feature_commands)


def handle_notice_release(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;release channel&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    # target_channel_id = data[&#39;extra&#39;][&#39;target_channel_id&#39;]
    # target_user_ids = data[&#39;extra&#39;][&#39;target_user_ids&#39;]
    print(&#34;NOTICE_RELEASE&#34;)

def handle_message(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles message to ccs.
        This can be the default behavior.
        When a message is sent, CCS will receive a response
        //TODO: describe later things, like what response and whistle parts
        def _send_message_down(self, ws, type_code, channel_id, to_user_ids, origin, **kwargs):
    &#34;&#34;&#34;
    self._send_message_down(ws, data[&#39;extra&#39;][&#39;type_code&#39;], data[&#39;extra&#39;][&#39;channel_id&#39;], data[&#39;extra&#39;][&#39;to_user_ids&#39;],
                            data[&#39;extra&#39;][&#39;origins&#39;])
    self.temp_msg_map[data[&#39;extra&#39;][&#39;temp_msg_id&#39;]] = data[&#39;extra&#39;][&#39;to_user_ids&#39;]</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="socialization.ccs.wrapped_god_service.handle_fetch_command"><code class="name flex">
<span>def <span class="ident">handle_fetch_command</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "fetch command" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_fetch_command(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;fetch command&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=channel_id, to_user_ids=[user_id], commands=self.feature_commands)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_fetch_recipient_list"><code class="name flex">
<span>def <span class="ident">handle_fetch_recipient_list</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_fetch_recipient_list(self, data, ws, path):
    pass</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_fetch_user_list"><code class="name flex">
<span>def <span class="ident">handle_fetch_user_list</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "fetch user list" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_fetch_user_list(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;fetch user list&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.join_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_join"><code class="name flex">
<span>def <span class="ident">handle_join</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "user join" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_join(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;user join&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.join_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=channel_id, to_user_ids=[user_id], commands=self.feature_commands)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_left"><code class="name flex">
<span>def <span class="ident">handle_left</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "user leave" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_left(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;user leave&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
    self.agent.leave_channel(channel_id, user_id)
    user_ids = self.agent.get_channel_user_list(channel_id)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=channel_id, to_user_ids=user_ids, user_ids=user_ids)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_message"><code class="name flex">
<span>def <span class="ident">handle_message</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles message to ccs.
This can be the default behavior.
When a message is sent, CCS will receive a response
//TODO: describe later things, like what response and whistle parts
def _send_message_down(self, ws, type_code, channel_id, to_user_ids, origin, **kwargs):</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_message(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles message to ccs.
        This can be the default behavior.
        When a message is sent, CCS will receive a response
        //TODO: describe later things, like what response and whistle parts
        def _send_message_down(self, ws, type_code, channel_id, to_user_ids, origin, **kwargs):
    &#34;&#34;&#34;
    self._send_message_down(ws, data[&#39;extra&#39;][&#39;type_code&#39;], data[&#39;extra&#39;][&#39;channel_id&#39;], data[&#39;extra&#39;][&#39;to_user_ids&#39;],
                            data[&#39;extra&#39;][&#39;origins&#39;])
    self.temp_msg_map[data[&#39;extra&#39;][&#39;temp_msg_id&#39;]] = data[&#39;extra&#39;][&#39;to_user_ids&#39;]</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_notice_release"><code class="name flex">
<span>def <span class="ident">handle_notice_release</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "release channel" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_notice_release(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;release channel&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    # target_channel_id = data[&#39;extra&#39;][&#39;target_channel_id&#39;]
    # target_user_ids = data[&#39;extra&#39;][&#39;target_user_ids&#39;]
    print(&#34;NOTICE_RELEASE&#34;)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_notice_take_over"><code class="name flex">
<span>def <span class="ident">handle_notice_take_over</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "take over channel" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_notice_take_over(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;take over channel&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    print(&#34;NOTICE_TAKE_OVER\n&#34;, data)
    target_channel_id = data[&#39;extra&#39;][&#39;target_channel_id&#39;]
    # target_channel_name = data[&#39;extra&#39;][&#39;target_channel_name&#39;]
    user_ids = data[&#34;extra&#34;][&#34;target_user_ids&#34;]
    self.agent.init_user_id_list(target_channel_id, user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CHANNEL_USER_LIST,
                            channel_id=target_channel_id, to_user_ids=user_ids, user_ids=user_ids)
    self._send_command_down(ws, self.codes.COMMAND_DOWN_UPDATE_CCS_COMMAND_LIST,
                            channel_id=target_channel_id, to_user_ids=user_ids, user_ids=user_ids, commands=self.feature_commands)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.handle_receive_user_list"><code class="name flex">
<span>def <span class="ident">handle_receive_user_list</span></span>(<span>self, data, ws, path)</span>
</code></dt>
<dd>
<div class="desc"><p>A function that handles the "get user list" notice.
This can be the default behavior.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_receive_user_list(self, data, ws, path):
    &#34;&#34;&#34;
        A function that handles the &#34;get user list&#34; notice.
        This can be the default behavior.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    user_ids = data[&#39;extra&#39;][&#39;user_ids&#39;]
    self.agent.init_user_id_list(channel_id, user_ids)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService"><code class="flex name class">
<span>class <span class="ident">WrappedGodService</span></span>
<span>(</span><span>name='WrappedGodService')</span>
</code></dt>
<dd>
<div class="desc"><p>This is the wrapped God service.
CCS provides a various of features for users in corresponding channels to use.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class WrappedGodService(BaseGodService):
    &#34;&#34;&#34;
        This is the wrapped God service.
        CCS provides a various of features for users in corresponding channels to use.
    &#34;&#34;&#34;

    def __init__(self, name=&#39;WrappedGodService&#39;):
        super().__init__()
        self.agent = WrappedGoddessDBAgent(name+&#34;.json&#34;)
        self.uri = None
        self.name = &#39;WrappedGodService&#39;
        self.feature_commands = []

        self.basic_command_func_map = {}
        self.notice_func_map = {}
        self.feature_func_map = {}

        self.prompt = {}

        self.message_func_map = {}
        
        self.temp_msg_map = {}

    def on_open(self, ws):
        &#34;&#34;&#34;
            Default behavior &#34;on_open&#34; for websocket.
            You can override this method to customize your own behavior.
            Also applies to &#34;on_message&#34;, &#34;on_error&#34; and &#34;on_close&#34;.
        &#34;&#34;&#34;
        data = {&#39;code&#39;: self.codes.COPERATION_GOD_RECONNECT, &#39;extra&#39;: {
            &#39;user_id&#39;: self.user_id, &#39;password&#39;: self.password}}
        print(&#39;SocialGodService send query: run: &#39;, data)
        self._send_ccs_operation(data, ws, None)
        print(self.name, &#39;opened&#39;)

    def add_feature(self, name, code, prompts, func=None):
        &#34;&#34;&#34;
            Add a feature to the service.
            Every feature contains a name, a code and a prompt.
            The code is always a five-digited int, and the first number must be 9, like 90001.
            The prompt here will be replaced by &#34;params&#34; in the future.
            Now it&#39;s the string that shows to the user in the input bar.
            You do not need to specify a handler func to the feature, but it&#39;s recommended to do so.
            If one feature with no handler is triggered, an exception will be raised.
            You can use set_feature_handle to set a handler for a feature.
        &#34;&#34;&#34;
        self.feature_commands.append(
            {&#39;name&#39;: name, &#39;code&#39;: code, &#39;prompts&#39;: [prompts] if prompts else []})
        self.prompt[code] = prompts
        if func:
            self.feature_func_map[code] = func

    def remove_feature(self, code):
        &#34;&#34;&#34;
            Remove a feature from the service.
            The feature is specified by its code.
        &#34;&#34;&#34;
        self.feature_commands = list(
            filter(lambda x: x[&#39;code&#39;] != code, self.feature_commands))
        self.feature_func_map.pop(code, None)

    def set_basic_command_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a basic command.
            The command is specified by its code.
            Some commands will be like &#34;help&#34;, &#34;quit&#34;.
        &#34;&#34;&#34;
        self.basic_command_func_map[code] = func

    def set_notice_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a notice.
            The notice is specified by its code.
            Some notices will be like &#34;user joined the channel&#34;, &#34;user left the channel&#34;.
        &#34;&#34;&#34;
        self.notice_func_map[code] = func

    def set_feature_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a feature.
            The feature is specified by its code.
        &#34;&#34;&#34;
        self.feature_func_map[code] = func

    def set_message_handle(self, code, func):
        &#34;&#34;&#34;
            Set a handler for a message.
            This code is always MESSAGE_TO_CCS.
        &#34;&#34;&#34;
        self.message_func_map[code] = func

    def _handle_data_dict(self, data, ws):
        print(
            f&#39;WrappedGodService: _handle_data_dict received {data} at websocket {ws}&#39;)
        if data[&#39;code&#39;] == self.codes.MESSAGE_TO_CCS:
            try:
                self._handle_message_to_ccs(data, ws, self.path)
            except Exception as e:
                print(&#39;WrappedGodService: _handle_message_to_ccs error: &#39;, e)
        elif data[&#39;code&#39;] == self.codes.COMMAND_TO_CCS:
            try:
                self._handle_command_to_ccs(data, ws, self.path)
            except Exception as e:
                print(&#39;WrappedGodService: _handle_command_to_ccs error: &#39;, e)
        else:
            raise Exception(&#39;no handler for code&#39;, data[&#39;code&#39;])

    def _handle_message_to_ccs(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.message_func_map:
            self.message_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no message function for code&#39;, type_code)

    def _handle_command_to_ccs(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if 20000 &lt;= type_code &lt;= 29999:
            self._handle_basic_command(data, ws, path)
        elif 80000 &lt;= type_code &lt;= 89999:
            self._handle_notice(data, ws, path)
        elif 90000 &lt;= type_code &lt;= 99999:
            self._handle_feature(data, ws, path)
        else:
            raise Exception(&#39;no command function for code&#39;, type_code)

    def _handle_basic_command(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.basic_command_func_map:
            self.basic_command_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no basic command function for code&#39;, type_code)

    def _handle_notice(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.notice_func_map:
            self.notice_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no notice function for code&#39;, type_code)

    def _handle_feature(self, data, ws, path):
        type_code = data[&#39;extra&#39;][&#39;type_code&#39;]
        if type_code in self.feature_func_map:
            self.feature_func_map[type_code](self, data, ws, path)
        else:
            raise Exception(&#39;no feature function for code&#39;, type_code)

    def _send_ccs_operation(self, data, ws, path):
        print(&#39;WrappedGodService ccs_operation: &#39;, data)
        code = data[&#39;code&#39;]
        password = data[&#39;extra&#39;][&#39;password&#39;]
        user_id = data[&#39;extra&#39;][&#39;user_id&#39;]
        if code == self.codes.COPERATION_GOD_RECONNECT:
            self._send_data_to_ws(
                ws, self.codes.COPERATION_GOD_RECONNECT, user_id=user_id, password=password)
        else:
            raise Exception(&#39;no ccs operation for code&#39;, code)

    def _send_command_down(self, ws, type_code, **kwargs):
        self._send_data_to_ws(ws, self.codes.COMMAND_FROM_CCS,
                              type_code=type_code, **kwargs)

    def _send_message_down(self, ws, type_code, channel_id, to_user_ids, origin, **kwargs):
        self._send_data_to_ws(ws, self.codes.MESSAGE_FROM_CCS,
                              type_code=type_code, channel_id=channel_id, to_user_ids=to_user_ids,
                              origin=origin, **kwargs)

    def broadcast_command_text(self, data, ws, text, clear=False):
        &#34;&#34;&#34;
            Broadcast a text to all users in a channel.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=self.agent.get_channel_user_list(channel_id),
            args={&#39;text&#39;: text, &#39;clear&#39;: clear}
        )

    def broadcast_command_image(self, data, ws, url):
        &#34;&#34;&#34;
            Broadcast an image to all users in a channel.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
            channel_id=channel_id,
            to_user_ids=self.agent.get_channel_user_list(channel_id),
            args={
                &#39;type&#39;: &#39;url&#39;,
                &#39;image&#39;: url
            }
        )

    def reply_command_text(self, data, ws, text, clear=False):
        &#34;&#34;&#34;
            Reply a text to a single user.
        &#34;&#34;&#34;
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;text&#39;: text, &#39;clear&#39;: clear}
        )

    def reply_command_image(self, data, ws, url):
        &#34;&#34;&#34;
            Reply an image to a single user.
        &#34;&#34;&#34;
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
            channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;type&#39;: &#39;url&#39;,  &#39;image&#39;: url}
        )

    def whistle_sender_command_text(
        self, data, ws, *,
        text_to_sender, text_to_others,
        clear_sender=False, clear_others=False
    ):
        &#34;&#34;&#34;
            Dog whistle.
        &#34;&#34;&#34;
        channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
        # to sender
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
            args={&#39;text&#39;: text_to_sender, &#39;clear&#39;: clear_sender}
        )
        # to others
        self._send_command_down(
            ws,
            self.codes.COMMAND_DOWN_DISPLAY_TEXT,
            channel_id=channel_id,
            to_user_ids=list(set(self.agent.get_channel_user_list(
                channel_id)) - {data[&#39;extra&#39;][&#39;user_id&#39;]}),
            args={&#39;text&#39;: text_to_others, &#39;clear&#39;: clear_others}
        )

    def set_account(self, user_id, password):
        &#34;&#34;&#34;
            Set the account for the service.
            Fetch these in CH0000.
        &#34;&#34;&#34;
        self.user_id = user_id
        self.password = password

    def run(self):
        &#34;&#34;&#34;
            Run the service.
        &#34;&#34;&#34;
        uri = &#39;wss://frog.4fun.chat/social&#39; if self.uri is None else self.uri
        ws = self.create_connection(
            uri, self.on_open, self.on_message, self.on_error, self.on_close)

        rel.signal(2, rel.abort)  # Keyboard Interrupt, one for all connections
        rel.dispatch()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="socialization.ccs.base_god_service.BaseGodService" href="base_god_service.html#socialization.ccs.base_god_service.BaseGodService">BaseGodService</a></li>
<li><a title="socialization.ccs.json_ws_active_service.JSONWebsocketActiveService" href="json_ws_active_service.html#socialization.ccs.json_ws_active_service.JSONWebsocketActiveService">JSONWebsocketActiveService</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.add_feature"><code class="name flex">
<span>def <span class="ident">add_feature</span></span>(<span>self, name, code, prompts, func=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a feature to the service.
Every feature contains a name, a code and a prompt.
The code is always a five-digited int, and the first number must be 9, like 90001.
The prompt here will be replaced by "params" in the future.
Now it's the string that shows to the user in the input bar.
You do not need to specify a handler func to the feature, but it's recommended to do so.
If one feature with no handler is triggered, an exception will be raised.
You can use set_feature_handle to set a handler for a feature.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_feature(self, name, code, prompts, func=None):
    &#34;&#34;&#34;
        Add a feature to the service.
        Every feature contains a name, a code and a prompt.
        The code is always a five-digited int, and the first number must be 9, like 90001.
        The prompt here will be replaced by &#34;params&#34; in the future.
        Now it&#39;s the string that shows to the user in the input bar.
        You do not need to specify a handler func to the feature, but it&#39;s recommended to do so.
        If one feature with no handler is triggered, an exception will be raised.
        You can use set_feature_handle to set a handler for a feature.
    &#34;&#34;&#34;
    self.feature_commands.append(
        {&#39;name&#39;: name, &#39;code&#39;: code, &#39;prompts&#39;: [prompts] if prompts else []})
    self.prompt[code] = prompts
    if func:
        self.feature_func_map[code] = func</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_image"><code class="name flex">
<span>def <span class="ident">broadcast_command_image</span></span>(<span>self, data, ws, url)</span>
</code></dt>
<dd>
<div class="desc"><p>Broadcast an image to all users in a channel.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def broadcast_command_image(self, data, ws, url):
    &#34;&#34;&#34;
        Broadcast an image to all users in a channel.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
        channel_id=channel_id,
        to_user_ids=self.agent.get_channel_user_list(channel_id),
        args={
            &#39;type&#39;: &#39;url&#39;,
            &#39;image&#39;: url
        }
    )</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_text"><code class="name flex">
<span>def <span class="ident">broadcast_command_text</span></span>(<span>self, data, ws, text, clear=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Broadcast a text to all users in a channel.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def broadcast_command_text(self, data, ws, text, clear=False):
    &#34;&#34;&#34;
        Broadcast a text to all users in a channel.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_TEXT,
        channel_id=channel_id,
        to_user_ids=self.agent.get_channel_user_list(channel_id),
        args={&#39;text&#39;: text, &#39;clear&#39;: clear}
    )</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.on_open"><code class="name flex">
<span>def <span class="ident">on_open</span></span>(<span>self, ws)</span>
</code></dt>
<dd>
<div class="desc"><p>Default behavior "on_open" for websocket.
You can override this method to customize your own behavior.
Also applies to "on_message", "on_error" and "on_close".</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_open(self, ws):
    &#34;&#34;&#34;
        Default behavior &#34;on_open&#34; for websocket.
        You can override this method to customize your own behavior.
        Also applies to &#34;on_message&#34;, &#34;on_error&#34; and &#34;on_close&#34;.
    &#34;&#34;&#34;
    data = {&#39;code&#39;: self.codes.COPERATION_GOD_RECONNECT, &#39;extra&#39;: {
        &#39;user_id&#39;: self.user_id, &#39;password&#39;: self.password}}
    print(&#39;SocialGodService send query: run: &#39;, data)
    self._send_ccs_operation(data, ws, None)
    print(self.name, &#39;opened&#39;)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.remove_feature"><code class="name flex">
<span>def <span class="ident">remove_feature</span></span>(<span>self, code)</span>
</code></dt>
<dd>
<div class="desc"><p>Remove a feature from the service.
The feature is specified by its code.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def remove_feature(self, code):
    &#34;&#34;&#34;
        Remove a feature from the service.
        The feature is specified by its code.
    &#34;&#34;&#34;
    self.feature_commands = list(
        filter(lambda x: x[&#39;code&#39;] != code, self.feature_commands))
    self.feature_func_map.pop(code, None)</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_image"><code class="name flex">
<span>def <span class="ident">reply_command_image</span></span>(<span>self, data, ws, url)</span>
</code></dt>
<dd>
<div class="desc"><p>Reply an image to a single user.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reply_command_image(self, data, ws, url):
    &#34;&#34;&#34;
        Reply an image to a single user.
    &#34;&#34;&#34;
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_IMAGE,
        channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
        to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
        args={&#39;type&#39;: &#39;url&#39;,  &#39;image&#39;: url}
    )</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_text"><code class="name flex">
<span>def <span class="ident">reply_command_text</span></span>(<span>self, data, ws, text, clear=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Reply a text to a single user.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reply_command_text(self, data, ws, text, clear=False):
    &#34;&#34;&#34;
        Reply a text to a single user.
    &#34;&#34;&#34;
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_TEXT,
        channel_id=data[&#39;extra&#39;][&#39;channel_id&#39;],
        to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
        args={&#39;text&#39;: text, &#39;clear&#39;: clear}
    )</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Run the service.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    &#34;&#34;&#34;
        Run the service.
    &#34;&#34;&#34;
    uri = &#39;wss://frog.4fun.chat/social&#39; if self.uri is None else self.uri
    ws = self.create_connection(
        uri, self.on_open, self.on_message, self.on_error, self.on_close)

    rel.signal(2, rel.abort)  # Keyboard Interrupt, one for all connections
    rel.dispatch()</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.set_account"><code class="name flex">
<span>def <span class="ident">set_account</span></span>(<span>self, user_id, password)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the account for the service.
Fetch these in CH0000.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_account(self, user_id, password):
    &#34;&#34;&#34;
        Set the account for the service.
        Fetch these in CH0000.
    &#34;&#34;&#34;
    self.user_id = user_id
    self.password = password</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.set_basic_command_handle"><code class="name flex">
<span>def <span class="ident">set_basic_command_handle</span></span>(<span>self, code, func)</span>
</code></dt>
<dd>
<div class="desc"><p>Set a handler for a basic command.
The command is specified by its code.
Some commands will be like "help", "quit".</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_basic_command_handle(self, code, func):
    &#34;&#34;&#34;
        Set a handler for a basic command.
        The command is specified by its code.
        Some commands will be like &#34;help&#34;, &#34;quit&#34;.
    &#34;&#34;&#34;
    self.basic_command_func_map[code] = func</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.set_feature_handle"><code class="name flex">
<span>def <span class="ident">set_feature_handle</span></span>(<span>self, code, func)</span>
</code></dt>
<dd>
<div class="desc"><p>Set a handler for a feature.
The feature is specified by its code.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_feature_handle(self, code, func):
    &#34;&#34;&#34;
        Set a handler for a feature.
        The feature is specified by its code.
    &#34;&#34;&#34;
    self.feature_func_map[code] = func</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.set_message_handle"><code class="name flex">
<span>def <span class="ident">set_message_handle</span></span>(<span>self, code, func)</span>
</code></dt>
<dd>
<div class="desc"><p>Set a handler for a message.
This code is always MESSAGE_TO_CCS.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_message_handle(self, code, func):
    &#34;&#34;&#34;
        Set a handler for a message.
        This code is always MESSAGE_TO_CCS.
    &#34;&#34;&#34;
    self.message_func_map[code] = func</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.set_notice_handle"><code class="name flex">
<span>def <span class="ident">set_notice_handle</span></span>(<span>self, code, func)</span>
</code></dt>
<dd>
<div class="desc"><p>Set a handler for a notice.
The notice is specified by its code.
Some notices will be like "user joined the channel", "user left the channel".</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_notice_handle(self, code, func):
    &#34;&#34;&#34;
        Set a handler for a notice.
        The notice is specified by its code.
        Some notices will be like &#34;user joined the channel&#34;, &#34;user left the channel&#34;.
    &#34;&#34;&#34;
    self.notice_func_map[code] = func</code></pre>
</details>
</dd>
<dt id="socialization.ccs.wrapped_god_service.WrappedGodService.whistle_sender_command_text"><code class="name flex">
<span>def <span class="ident">whistle_sender_command_text</span></span>(<span>self, data, ws, *, text_to_sender, text_to_others, clear_sender=False, clear_others=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Dog whistle.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def whistle_sender_command_text(
    self, data, ws, *,
    text_to_sender, text_to_others,
    clear_sender=False, clear_others=False
):
    &#34;&#34;&#34;
        Dog whistle.
    &#34;&#34;&#34;
    channel_id = data[&#39;extra&#39;][&#39;channel_id&#39;]
    # to sender
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_TEXT,
        channel_id=channel_id,
        to_user_ids=[data[&#39;extra&#39;][&#39;user_id&#39;]],
        args={&#39;text&#39;: text_to_sender, &#39;clear&#39;: clear_sender}
    )
    # to others
    self._send_command_down(
        ws,
        self.codes.COMMAND_DOWN_DISPLAY_TEXT,
        channel_id=channel_id,
        to_user_ids=list(set(self.agent.get_channel_user_list(
            channel_id)) - {data[&#39;extra&#39;][&#39;user_id&#39;]}),
        args={&#39;text&#39;: text_to_others, &#39;clear&#39;: clear_others}
    )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="socialization.ccs" href="index.html">socialization.ccs</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="socialization.ccs.wrapped_god_service.handle_fetch_command" href="#socialization.ccs.wrapped_god_service.handle_fetch_command">handle_fetch_command</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_fetch_recipient_list" href="#socialization.ccs.wrapped_god_service.handle_fetch_recipient_list">handle_fetch_recipient_list</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_fetch_user_list" href="#socialization.ccs.wrapped_god_service.handle_fetch_user_list">handle_fetch_user_list</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_join" href="#socialization.ccs.wrapped_god_service.handle_join">handle_join</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_left" href="#socialization.ccs.wrapped_god_service.handle_left">handle_left</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_message" href="#socialization.ccs.wrapped_god_service.handle_message">handle_message</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_notice_release" href="#socialization.ccs.wrapped_god_service.handle_notice_release">handle_notice_release</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_notice_take_over" href="#socialization.ccs.wrapped_god_service.handle_notice_take_over">handle_notice_take_over</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.handle_receive_user_list" href="#socialization.ccs.wrapped_god_service.handle_receive_user_list">handle_receive_user_list</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService" href="#socialization.ccs.wrapped_god_service.WrappedGodService">WrappedGodService</a></code></h4>
<ul class="">
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.add_feature" href="#socialization.ccs.wrapped_god_service.WrappedGodService.add_feature">add_feature</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_image" href="#socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_image">broadcast_command_image</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_text" href="#socialization.ccs.wrapped_god_service.WrappedGodService.broadcast_command_text">broadcast_command_text</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.on_open" href="#socialization.ccs.wrapped_god_service.WrappedGodService.on_open">on_open</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.remove_feature" href="#socialization.ccs.wrapped_god_service.WrappedGodService.remove_feature">remove_feature</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_image" href="#socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_image">reply_command_image</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_text" href="#socialization.ccs.wrapped_god_service.WrappedGodService.reply_command_text">reply_command_text</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.run" href="#socialization.ccs.wrapped_god_service.WrappedGodService.run">run</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.set_account" href="#socialization.ccs.wrapped_god_service.WrappedGodService.set_account">set_account</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.set_basic_command_handle" href="#socialization.ccs.wrapped_god_service.WrappedGodService.set_basic_command_handle">set_basic_command_handle</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.set_feature_handle" href="#socialization.ccs.wrapped_god_service.WrappedGodService.set_feature_handle">set_feature_handle</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.set_message_handle" href="#socialization.ccs.wrapped_god_service.WrappedGodService.set_message_handle">set_message_handle</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.set_notice_handle" href="#socialization.ccs.wrapped_god_service.WrappedGodService.set_notice_handle">set_notice_handle</a></code></li>
<li><code><a title="socialization.ccs.wrapped_god_service.WrappedGodService.whistle_sender_command_text" href="#socialization.ccs.wrapped_god_service.WrappedGodService.whistle_sender_command_text">whistle_sender_command_text</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>