"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_index_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,n)=>{n.d(t,{AA:()=>y,JC:()=>x,ZP:()=>b,o:()=>p});var r=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),o=n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),i=n("./app/api.tsx"),a=n("./app/locale.tsx"),c=n("./app/utils/discover/eventView.tsx"),u=n("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=n("./app/views/organizationContext.tsx"),d=n("./app/utils/useApi.tsx"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class p{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class h extends s.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new i.KU}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=v(this.props),n=v(e);return!(0,c.ze)(t,n)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new p(t,e);const n=t?.message;return new p("string"==typeof n?n:(0,a.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:n,didFetch:r,eventView:s,orgSlug:o,route:i,setError:a}=this.props,{api:c}=this.state;if(!s.isValid())return;const u=`/organizations/${o}/${i}/`,l=Symbol("tableFetchID"),d=v(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(c),c.clear();try{const[t,,s]=await y(c,u,d,{queryBatching:e});if(this.state.tableFetchID!==l)return;const o=n?n(t,this.props):t;r?.(o),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:s?.getResponseHeader("Link")??e.pageLinks,tableData:o})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),n=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||n||r)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:n,pageLinks:r}=this.state,s={isLoading:e,error:t,tableData:n,pageLinks:r};return(0,this.props.children)?.(s)}}function g(e){const t=(0,s.useContext)(l.g)?.slug,n=(0,s.useContext)(u.uL)?.eventView,r=e.orgSlug??t,o=e.eventView??n;if(void 0===r||void 0===o)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const i={...e,orgSlug:r,eventView:o};return(0,m.tZ)(h,{...i})}h.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=e=>new Promise((t=>setTimeout(t,e)));async function y(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:s,retry:o}=r;if(s?.batchRequest)return s.batchRequest(e,t,{query:n,includeAllArgs:!0});const i=o?.baseTimeout??200,a=o?.timeoutMultiplier??2,c=o?.statusCodes??[],u=o?.tries??1;let l,d=0,m=0;for(;d<u&&(!l||c.includes(l.status));){m>0&&await f(m);try{return d++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...n}})}catch(e){l=e,m=i*a**(d-1)}}throw l}function v(e){const{cursor:t,limit:n,noPagination:r,referrer:s,getRequestPayload:o,eventView:i,location:a,forceAppendRawQueryString:c}=e,u=o?o(e):i.getEventsAPIPayload(a,c);return t&&(u.cursor=t),n&&(u.per_page=n),r&&(u.noPagination=r),s&&(u.referrer=s),Object.assign(u,e.queryExtras??{}),u}function x(e){const t=(0,d.Z)(),{orgSlug:n,route:r}=e,s=`/organizations/${n}/${r}/`,i=v(e);return(0,o.a)([r,i],(async()=>{const[n]=await y(t,s,i,{queryBatching:e.queryBatching});return n}))}const b=g},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,n)=>{n.d(t,{BT:()=>b,e0:()=>P}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("../node_modules/react/index.js"),s=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),o=n("./app/utils/dates.tsx"),i=n("./app/utils/discover/eventView.tsx"),a=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),c=n("../node_modules/lodash/omit.js"),u=n.n(c),l=n("./app/utils/discover/genericDiscoverQuery.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{eventView:t,location:n}=e;return u()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function p(e){let{children:t,...n}=e;return(0,d.tZ)(l.ZP,{route:"metrics-compatibility-sums",getRequestPayload:m,...n,children:e=>{let{tableData:n,...r}=e;return t({tableData:n,...r})}})}function h(e){let{eventView:t,location:n}=e;return u()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function g(e){let{children:t,...n}=e;return(0,d.tZ)(l.ZP,{route:"metrics-compatibility",getRequestPayload:h,...n,children:e=>{let{tableData:n,...r}=e;return t({tableData:n,...r})}})}p.displayName="MetricsCompatibilityQuery",g.displayName="MetricsCompatibilitySumsQuery";var f=n("./app/utils/performance/contexts/utils.tsx");const[y,v,x]=(0,f.n)({name:"MetricsCardinalityContext",strict:!1}),b=e=>{if(!(0,a.gp)(e.organization))return(0,d.tZ)(y,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},n=i.ZP.fromLocation(e.location);n.fields=[{field:"tpm()"}];const s=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,o.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(n);return(0,d.tZ)(r.Fragment,{children:(0,d.tZ)(p,{eventView:s,...t,children:n=>(0,d.tZ)(g,{eventView:s,...t,children:t=>{const r=n.isLoading||t.isLoading,s=n.isLoading||t.isLoading?void 0:function(e,t,n){const r={forceTransactionsOnly:!0},s=n.features.includes("performance-mep-bannerless-ui");if(!e)return r;const o=e.compatible_projects;return t?r:e?function(e){return!C(e).metricsCount}(e)?r:function(e,t){const n=C(e);return t?n.nullCount/n.metricsCount>.01:n.nullCount>0}(e,s)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e){const t=C(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e,t){const n=C(e);return t?n.unparamCount/n.metricsCount>.01:n.unparamCount>0}(e,s)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:o,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}(n.tableData&&t.tableData?{...n.tableData,...t.tableData}:null,!!n.error&&!!t.error,e.organization);return(0,d.tZ)(w,{sendOutcomeAnalytics:e.sendOutcomeAnalytics,organization:e.organization,value:{isLoading:r,outcome:s},children:e.children})}})})})};b.displayName="MetricsCardinalityProvider";const w=e=>{const t=e.value.outcome?.shouldWarnIncompatibleSDK??!1,n=e.value.outcome?.shouldNotifyUnnamedTransactions??!1,o=!e.value.outcome?.forceTransactionsOnly;return(0,r.useEffect)((()=>{!e.value.isLoading&&e.sendOutcomeAnalytics&&(0,s.Z)("performance_views.mep.metrics_outcome",{organization:e.organization,is_on_metrics:o,fallback_from_null:t,fallback_from_unparam:n})}),[e.organization,e.value.isLoading,o,n,t,e.sendOutcomeAnalytics]),(0,d.tZ)(y,{...e,children:e.children})};w.displayName="Provider",x.Consumer;const P=v;function C(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(e,t,n)=>{n.d(t,{Eg:()=>v,gp:()=>f,kP:()=>y,nP:()=>m,nl:()=>p,oR:()=>h,tm:()=>g}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("../node_modules/react/index.js"),s=n("../node_modules/react-router/es/index.js"),o=(n("./app/utils/localStorage.tsx"),n("./app/utils/queryString.tsx")),i=n("./app/utils/useOrganization.tsx"),a=n("./app/utils/performance/contexts/utils.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[u,l,d]=(0,a.n)({name:"MetricsEnhancedSettingContext"}),m=d.Consumer;let p,h;!function(e){e.unset="unset",e.metrics="metrics",e.transactions="transactions"}(p||(p={})),function(e){e.auto="auto",e.metricsOnly="metricsOnly",e.transactionsOnly="transactionsOnly"}(h||(h={}));const g="metricSearchSetting";function f(e){const t=function(e){return e.features.includes("performance-use-metrics")}(e),n=e.features.includes("performance-transaction-name-only-search"),r=e.features.includes("dynamic-sampling")&&e.features.includes("mep-rollout-flag");return t||n||r}const y=e=>{let{children:t,location:n,_hasMEPState:a,forceTransactions:l}=e;const d=f((0,i.Z)()),m=[h.metricsOnly,h.transactionsOnly],g=n?(0,o.ro)(n.query.metricSetting):h.metricsOnly;let y=h.metricsOnly;l&&(y=h.transactionsOnly);const v=m.find((e=>e===g))??y,x=void 0!==a,[b,w]=(0,r.useReducer)(((e,t)=>t),v),P=(0,r.useCallback)((e=>{n&&(s.browserHistory.replace({...n,query:{...n.query,metricSetting:e}}),w(e))}),[n,w]),[C,_]=(0,r.useReducer)(((e,t)=>t),p.unset),j=x?a:b,D=d&&j===h.auto,S=d&&j===h.metricsOnly,Z=d&&j===h.transactionsOnly,E=`${j}`;return(0,c.tZ)(u,{value:{autoSampleState:C,metricSettingState:j,shouldQueryProvideMEPAutoParams:D,shouldQueryProvideMEPMetricParams:S,shouldQueryProvideMEPTransactionParams:Z,memoizationKey:E,setMetricSettingState:P,setAutoSampleState:_},children:t})};y.displayName="MEPSettingProvider";const v=l},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,n)=>{n.d(t,{bq:()=>s,uL:()=>i});var r=n("./app/utils/performance/contexts/utils.tsx");const[s,o,i]=(0,r.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,n)=>{n.d(t,{n:()=>s}),n("../node_modules/core-js/modules/es.error.cause.js");var r=n("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:n=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,o=(0,r.createContext)(void 0);return o.displayName=s,[o.Provider,function(){const e=(0,r.useContext)(o);if(!e&&t)throw new Error(n);return e},o]}},"./app/views/performance/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n("../node_modules/@tanstack/query-core/build/lib/queryClient.mjs"),s=n("../node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),o=n("./app/components/acl/feature.tsx"),i=n("./app/components/alert.tsx"),a=n("./app/components/layouts/thirds.tsx"),c=n("./app/components/noProjectMessage.tsx"),u=n("./app/locale.tsx"),l=n("./app/utils/performance/contexts/metricsCardinality.tsx"),d=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),m=n("./app/utils/withOrganization.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h=new r.S;function g(e){let{organization:t,location:n,children:r}=e;return(0,p.tZ)(o.Z,{hookName:"feature-disabled:performance-page",features:["performance-view"],organization:t,renderDisabled:function(){return(0,p.tZ)(a.T3,{withPadding:!0,children:(0,p.tZ)(i.bZ,{type:"warning",children:(0,u.t)("You don't have access to this feature")})})},children:(0,p.tZ)(c.Z,{organization:t,children:(0,p.tZ)(s.aH,{client:h,children:(0,p.tZ)(l.BT,{location:n,organization:t,children:(0,p.tZ)(d.kP,{children:r})})})})})}g.displayName="PerformanceContainer";const f=(0,m.Z)(g)}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_index_tsx.e7739d3e82b9bd306e21320c791f546d.js.map