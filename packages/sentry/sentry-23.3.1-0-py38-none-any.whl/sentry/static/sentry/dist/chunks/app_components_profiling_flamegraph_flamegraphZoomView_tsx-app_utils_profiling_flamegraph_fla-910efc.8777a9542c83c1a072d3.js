"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_profiling_flamegraph_flamegraphZoomView_tsx-app_utils_profiling_flamegraph_fla-910efc"],{"./app/components/gridEditable/sortLink.tsx":(e,t,r)=>{r.d(t,{Z:()=>f});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=r("../node_modules/react-router/es/index.js"),i=r("../node_modules/lodash/omit.js"),s=r.n(i),a=r("./app/components/links/link.tsx"),l=r("./app/icons/index.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{align:t,title:r,canSort:n,generateSortLink:i,onClick:s,direction:a,replace:l}=e;const u=i();if(!u||!n)return(0,c.tZ)(p,{align:t,children:r});const f=a?(0,c.tZ)(h,{size:"xs",direction:"desc"===a?"down":"up"}):null;return(0,c.BX)(d,{align:t,to:u,onClick:e=>{l&&(e.preventDefault(),o.browserHistory.replace(u)),s?.(e)},children:[r," ",f]})}u.displayName="SortLink";const d=(0,n.Z)((e=>{const t=s()(e,["align","css"]);return(0,c.tZ)(a.Z,{...t})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,n.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),h=(0,n.Z)(l.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),f=u},"./app/components/profiling/flamegraph/flamegraphZoomView.tsx":(e,t,r)=>{r.d(t,{L:()=>K});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/react/index.js")),i=r("../node_modules/gl-matrix/esm/vec2.js"),s=r("./app/actionCreators/indicator.tsx"),a=r("./app/components/profiling/profilingContextMenu.tsx"),l=r("./app/icons/index.tsx"),c=r("./app/locale.tsx"),u=r("./app/utils.tsx"),d=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphPreferences.ts"),p=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts"),h=r("./app/utils/useApi.tsx"),f=r("./app/utils/useOrganization.tsx"),m=r("./app/utils/useProjects.tsx"),g=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const v=["by system vs application frame","by system frame","by application frame","by symbol name","by library","by recursion","by frequency"],_=["top down","bottom up"],w=["call order","alphabetical","left heavy"];function x(e){return void 0!==e&&("node"===e||"python"===e)}function y(e){const t=(0,h.Z)(),{projects:r}=(0,m.Z)(),n=(0,f.Z)(),i=(0,d.K)(),s=(0,p.T)(),[y,b]=(0,o.useState)({type:"initial"});(0,o.useEffect)((()=>{if(!e.hoveredNode||!e.profileGroup)return b({type:"initial"});if(!x(e.profileGroup.metadata.platform))return;const o=r.find((t=>t.id===String(e.profileGroup?.metadata?.projectID)));if(!o||!e.hoveredNode)return;const i=e.profileGroup.metadata,s=i.release?.lastCommit?.id,a=i.platform,l=e.hoveredNode.frame;return b({type:"loading"}),t.requestPromise(`/projects/${n.slug}/${o.slug}/stacktrace-link/`,{query:{file:l.file,platform:a,commitId:s,...l.path&&{absPath:l.path}}}).then((e=>{b({type:"resolved",data:e})})),()=>{t.clear()}}),[e.hoveredNode,t,r,n,e.profileGroup]);const C=(0,o.useCallback)((()=>{if("resolved"!==y.type)return;if(!y.data.sourceUrl||"github"!==y.data.config?.provider?.key)return;const t=(0,u.ri)(e.hoveredNode)&&(0,u.ri)(e.hoveredNode.frame.line)?`${y.data.sourceUrl}#L${e.hoveredNode.frame.line}`:y.data.sourceUrl;window.open(t,"_blank","noopener,noreferrer")}),[e.hoveredNode,y]);return e.contextMenu.open?(0,g.BX)(o.Fragment,{children:[(0,g.tZ)(a.rE,{onClick:()=>e.contextMenu.setOpen(!1)}),(0,g.BX)(a.n2,{...e.contextMenu.getMenuProps(),style:{position:"absolute",left:e.contextMenu.position?.left??-9999,top:e.contextMenu.position?.top??-9999,maxHeight:e.contextMenu.containerCoordinates?.height??"auto"},children:[e.hoveredNode?(0,g.BX)(a.dE,{children:[(0,g.tZ)(a.mP,{children:(0,c.t)("Frame")}),(0,g.tZ)(a.pb,{...e.contextMenu.getMenuItemProps({onClick:e.onHighlightAllOccurencesClick}),checked:e.isHighlightingAllOccurences,children:(0,c.t)("Highlight all occurrences")}),(0,g.tZ)(a.Oz,{...e.contextMenu.getMenuItemProps({onClick:()=>{e.onCopyFunctionNameClick(),e.contextMenu.setOpen(!1)}}),icon:(0,g.tZ)(l.vU,{size:"xs"}),children:(0,c.t)("Copy function name")}),(0,g.tZ)(a.Oz,{disabled:"resolved"!==y.type||!("resolved"===y.type&&y.data.sourceUrl),tooltip:x(e.profileGroup?.metadata?.platform)?"resolved"!==y.type||y.data.sourceUrl&&"github"===y.data.config?.provider?.key?void 0:(0,c.t)("Could not find source code location in GitHub"):(0,c.t)("Open in GitHub is not yet supported for this platform"),...e.contextMenu.getMenuItemProps({onClick:C}),icon:(0,g.tZ)(l.Uv,{size:"xs"}),children:(0,c.t)("Open in GitHub")})]}):null,(0,g.BX)(a.dE,{children:[(0,g.tZ)(a.mP,{children:(0,c.t)("Color Coding")}),v.map(((t,r)=>(0,g.tZ)(a.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set color coding",payload:t})}),onClick:()=>s({type:"set color coding",payload:t}),checked:i.colorCoding===t,children:t},r)))]}),(0,g.BX)(a.dE,{children:[(0,g.tZ)(a.mP,{children:(0,c.t)("View")}),_.map(((t,r)=>(0,g.tZ)(a.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set view",payload:t})}),onClick:()=>s({type:"set view",payload:t}),checked:i.view===t,children:t},r)))]}),(0,g.BX)(a.dE,{children:[(0,g.tZ)(a.mP,{children:(0,c.t)("Sorting")}),w.map(((t,r)=>e.disableCallOrderSort&&"call order"===t?null:(0,g.tZ)(a.pb,{...e.contextMenu.getMenuItemProps({onClick:()=>s({type:"set sorting",payload:t})}),onClick:()=>s({type:"set sorting",payload:t}),checked:i.sorting===t,children:t},r)))]})]})]}):null}var b=r("./app/components/profiling/flamegraph/flamegraphTooltip.tsx"),C=r("./app/utils/profiling/canvasScheduler.tsx");function R(e,t){if("up"===t){const t=e.parent;if(t?.frame.isRoot)return e;if(t)return t;return E(e,"left")||e}if("down"===t){const t=e.children?.[0];if(t)return t;return S(e,"right")||e}const r=S(e,t);if(r){const n=function(e,t,r){let n=e,o=n.children["right"===r?0:n.children.length-1];for(;n&&o;){if(n.depth===t)return n;o=n.children["right"===r?0:n.children.length-1],o&&(n=o)}return n}(r,e.depth,t);if(n)return n}return e}function S(e,t){let r=e;for(;r;){const e=E(r,t);if(e)return e;if(!r.parent)break;r=r.parent}return e}function E(e,t){const r=e.parent;if(!r)return null;const n=r.children.indexOf(e);if(-1===n)throw Error("frame.parent.children does not include current frame");return"right"===t?n<r.children.length-1?r.children[n+1]:null:n>0?r.children[n-1]:null}r("../node_modules/core-js/modules/es.error.cause.js");const k={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",Tab:"down","Shift+Tab":"up"};var F=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphSearch.ts"),I=r("./app/utils/profiling/flamegraph/useFlamegraphTheme.ts"),O=r("./app/utils/profiling/gl/utils.ts"),L=r("./app/utils/profiling/hooks/useContextMenu.tsx");const Z="__fgdb__";var D=r("./app/utils/profiling/renderers/flamegraphTextRenderer.tsx"),j=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),A=r("./app/utils/profiling/speedscope.tsx");function M(e,t){const r=e[0]*t+e[6];return r>1?Math.round(r):Math.round(10*r)/10}class P{constructor(e,t,r){(0,j.Z)(this,"canvas",void 0),(0,j.Z)(this,"context",void 0),(0,j.Z)(this,"theme",void 0),(0,j.Z)(this,"formatter",void 0),this.canvas=e,this.theme=t,this.formatter=r,this.context=(0,O.fw)(e,"2d")}draw(e,t,r,n){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this.context.font=`${this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio}px ${this.theme.FONTS.FONT}`,this.context.textBaseline="top",this.context.lineWidth=this.theme.SIZES.GRID_LINE_WIDTH/2,this.context.fillStyle=this.theme.COLORS.GRID_FRAME_BACKGROUND_COLOR,this.context.fillRect(0,0,t.width,this.theme.SIZES.TIMELINE_HEIGHT*window.devicePixelRatio),this.context.fillStyle=this.theme.COLORS.GRID_LINE_COLOR,this.context.fillRect(0,0,t.width,this.theme.SIZES.GRID_LINE_WIDTH/2),this.context.fillRect(0,this.theme.SIZES.TIMELINE_HEIGHT*window.devicePixelRatio,t.width,this.theme.SIZES.GRID_LINE_WIDTH/2),o){const o=(0,A.NV)(e,n,M);for(let e=0;e<o.length;e++){const n=Math.round(o[e]*r[0]+r[6]),i=this.formatter(o[e]);this.context.fillStyle=this.theme.COLORS.LABEL_FONT_COLOR,this.context.fillText(i,n-(0,O.X1)(i,this.context).width-this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio,this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio),this.context.strokeStyle=this.theme.COLORS.GRID_LINE_COLOR,this.context.strokeRect(n-this.theme.SIZES.GRID_LINE_WIDTH/2,t.y,this.theme.SIZES.GRID_LINE_WIDTH/2,t.height)}}}}r("../node_modules/core-js/modules/es.array.push.js");class T{constructor(e,t,r,n){(0,j.Z)(this,"canvas",void 0),(0,j.Z)(this,"context",void 0),(0,j.Z)(this,"theme",void 0),(0,j.Z)(this,"flamegraph",void 0),(0,j.Z)(this,"intervals",void 0),this.canvas=e,this.flamegraph=t,this.theme=n,this.intervals=function(e,t){if(!t.length)return[];const r=t[0];if("number"!=typeof r)throw new Error("Invalid weights, expected an array of numbers");const n=[e+r];for(let e=1;e<t.length;e++){const r=n[e-1];n.push(r+t[e])}return n}(r.x,this.flamegraph.profile.rawWeights),this.context=(0,O.fw)(e,"2d")}draw(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.context;if(0===this.intervals.length)return;const n=this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio+this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio*2-this.theme.SIZES.LABEL_FONT_PADDING;r.strokeStyle=`rgba(${this.theme.COLORS.SAMPLE_TICK_COLOR.join(",")})`,r.lineWidth=this.theme.SIZES.INTERNAL_SAMPLE_TICK_LINE_WIDTH;for(let o=0;o<this.intervals.length;o++){const i=this.intervals[o];if(i<t.left)continue;if(i>t.right)break;const s=Math.round(i*e[0]+e[6]);r.strokeRect(s,0,0,n)}}}var B=r("./app/utils/profiling/renderers/selectedFrameRenderer.tsx"),N=r("./app/views/profiling/profileGroupProvider.tsx"),z=r("./app/components/profiling/flamegraph/interactions/useCanvasScroll.tsx"),H=r("./app/components/profiling/flamegraph/interactions/useCanvasZoomOrScroll.tsx"),X=r("./app/components/profiling/flamegraph/interactions/useDrawHoveredBorderEffect.tsx"),W=r("./app/components/profiling/flamegraph/interactions/useDrawSelectedBorderEffect.tsx"),G=r("./app/components/profiling/flamegraph/interactions/useInteractionViewCheckPoint.tsx"),V=r("./app/components/profiling/flamegraph/interactions/useWheelCenterZoom.tsx");function U(e,t){return!!(t&&e&&t.length>1&&t.includes(e))}function K(e){let{canvasPoolManager:t,canvasBounds:r,flamegraphRenderer:n,flamegraph:a,flamegraphCanvas:l,flamegraphCanvasRef:u,flamegraphOverlayCanvasRef:d,flamegraphView:h,setFlamegraphCanvasRef:f,setFlamegraphOverlayCanvasRef:m,disablePanX:v=!1,disableZoom:_=!1,disableGrid:w=!1,disableCallOrderSort:x=!1}=e;const S=(0,I.W)(),E=(0,N.A)(),j=(0,F.f)(),M=function(){const[e,t]=(0,o.useState)("1"===sessionStorage.getItem(Z));return(0,o.useEffect)((()=>{function e(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&"KeyI"===e.code&&(e.preventDefault(),t((e=>{const t=!e;return t?sessionStorage.setItem(Z,"1"):sessionStorage.removeItem(Z),t})))}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)})),e}(),[K,q]=(0,o.useState)(null),J=(0,p.T)(),Q=(0,C.IZ)(t),ee=(0,o.useRef)(null),[te,{previousState:re,nextState:ne}]=(0,p.I)(),[oe,ie]=(0,o.useState)(null),[se,ae]=(0,o.useState)(null),le=(0,o.useMemo)((()=>d?new D.G(d,S,a):null),[a,d,S]),ce=(0,o.useMemo)((()=>!d||w?null:new P(d,S,a.formatter)),[d,a,S,w]),ue=(0,o.useMemo)((()=>M&&d&&h?.configSpace?new T(d,a,h.configSpace,S):null),[M,d,a,h?.configSpace,S]),de=(0,o.useMemo)((()=>d?new B.d(d):null),[d]),pe=(0,o.useMemo)((()=>se&&n?n.findHoveredNode(se):null),[se,n]);(0,o.useEffect)((()=>{n&&n.setSearchResults(j.query,j.results.frames)}),[n,j.query,j.results]),(0,o.useEffect)((()=>{if(!(l&&h&&le&&n))return;const e=()=>{le.context.clearRect(0,0,le.canvas.width,le.canvas.height)},t=()=>{le.draw(h.toOriginConfigView(h.configView),h.fromTransformedConfigView(l.physicalSpace),j.results.frames)},r=()=>{ue&&ue.draw(h.fromTransformedConfigView(l.physicalSpace),h.configView)},o=ce?()=>{ce.draw(h.configView,l.physicalSpace,h.fromConfigView(l.physicalSpace),h.toConfigView(l.logicalSpace),"flamechart"===a.profile.type)}:void 0,i=()=>{n.draw(h.fromTransformedConfigView(l.physicalSpace))};return Q.registerBeforeFrameCallback(i),Q.registerBeforeFrameCallback(e),Q.registerAfterFrameCallback(t),o&&Q.registerAfterFrameCallback(o),Q.registerAfterFrameCallback(r),Q.draw(),()=>{Q.unregisterBeforeFrameCallback(e),Q.unregisterAfterFrameCallback(t),Q.unregisterAfterFrameCallback(r),o&&Q.unregisterAfterFrameCallback(o),Q.unregisterBeforeFrameCallback(i)}}),[l,h,Q,a,S,le,ce,n,ue,t,j.results.frames]);const he=(0,o.useRef)(null);(0,o.useEffect)((()=>{if(te.profiles.highlightFrames){let e=a.findAllMatchingFrames(te.profiles.highlightFrames.name,te.profiles.highlightFrames.package);e.length||te.profiles.highlightFrames.package||!te.profiles.highlightFrames.name||(e=a.findAllMatchingFramesBy(te.profiles.highlightFrames.name,["name"])),he.current=e}else he.current=null;n&&n?.setHighlightedFrames(he.current)}),[a,n,te.profiles.highlightFrames]),(0,G.C)({view:h,lastInteraction:K}),(0,W.B)({scheduler:Q,selectedRef:he,canvas:l,view:h,eventKey:"highlight frame",theme:S,renderer:de}),(0,X.B)({scheduler:Q,hoveredNode:pe,canvas:l,view:h,theme:S,renderer:de}),(0,o.useEffect)((()=>{if(!l||!h)return;const e=()=>{ae(null)},t=(e,t)=>{e&&(he.current=[e]),ae(null)};return Q.on("reset zoom",e),Q.on("zoom at frame",t),()=>{Q.off("reset zoom",e),Q.off("zoom at frame",t)}}),[l,t,J,Q,h]),(0,o.useEffect)((()=>{const e=e=>{if(h){if("z"===e.key&&e.metaKey){const r=e.shiftKey?"redo":"undo";if("undo"===r){const e=re?.position?.view;e?.isEmpty()?t.dispatch("reset zoom",[]):e&&!e?.equals(h.configView)&&t.dispatch("set config view",[e,h])}if("redo"===r){const e=ne?.position?.view;e&&!e.equals(h.configView)&&t.dispatch("set config view",[e,h])}J({type:r})}if(e.target===u){const r=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;const n=e.shiftKey?`Shift+${e.key}`:e.key;let o=k[n];if(!o)return null;!r||"up"!==o&&"down"!==o||(o="up"===o?"down":"up");const i=R(t,o);return i===t?null:(e.preventDefault(),i)}(e,he.current?.[0],a.inverted);r&&t.dispatch("zoom at frame",[r,"min"])}}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t,J,ne,re,h,Q,u,a.inverted]);const fe=(0,o.useCallback)((e=>{q("click"),ie((0,O.YG)(e.nativeEvent.offsetX,e.nativeEvent.offsetY))}),[]),me=(0,o.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),!se)return q(null),void ie(null);"click"===K&&(pe&&1===he.current?.length&&he.current[0]===pe&&(t.dispatch("zoom at frame",[pe,"exact"]),t.dispatch("show in table view",[pe])),J({type:"set highlight all frames",payload:null}),t.dispatch("highlight frame",[pe?[pe]:null,"selected"])),q(null),ie(null)}),[se,J,pe,t,K]),ge=(0,o.useCallback)((e=>{if(!l||!h||!oe)return;const r=(0,O.i7)(e.nativeEvent.offsetX,e.nativeEvent.offsetY,oe,h,l);r&&(t.dispatch("transform config view",[r,h]),ie((0,O.YG)(e.nativeEvent.offsetX,e.nativeEvent.offsetY)))}),[l,h,oe,t]),ve=(0,o.useCallback)((e=>{l&&h&&(ae(h.getTransformedConfigViewCursor(i.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),l)),oe?(ge(e),q("pan")):q(null))}),[l,h,ae,ge,oe]),_e=(0,o.useCallback)((()=>{ae(null),ie(null),q(null)}),[]),we=(0,V.T)(l,h,t,_),xe=(0,z.g)(l,h,t,v);(0,H.k)({setConfigSpaceCursor:ae,setLastInteraction:q,handleWheel:we,handleScroll:xe,canvas:u}),(0,o.useEffect)((()=>{const e=e=>{ee.current&&!ee.current.contains(e.target)&&(t.dispatch("highlight frame",[null,"selected"]),ae(null))};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}));const ye=(0,o.useRef)(null),be=(0,L.a)({container:u}),[Ce,Re]=(0,o.useState)(U(pe,he.current)),Se=(0,o.useCallback)((e=>{ye.current=pe,be.handleContextMenu(e),Re(U(pe,he.current))}),[be,pe]),Ee=(0,o.useCallback)((()=>{if(!ye.current||!h)return;if(U(ye.current,he.current))return Re(!1),J({type:"set highlight all frames",payload:null}),void t.dispatch("highlight frame",[null,"selected"]);Re(!0);const e=ye.current.frame.name,r=ye.current.frame.package??ye.current.frame.module??"";J({type:"set highlight all frames",payload:{name:e,package:r}});const n=a.findAllMatchingFrames(e,r),o=n.map((e=>new A.UL(e.start,e.depth,e.end-e.start,1))),i=(0,O.v5)(h.configView,o);t.dispatch("highlight frame",[n,"selected"]),t.dispatch("set config view",[i,h])}),[t,a,h,J]),ke=(0,o.useCallback)((()=>{ye.current&&navigator.clipboard.writeText(ye.current.frame.name).then((()=>{(0,s.S9)((0,c.t)("Function name copied to clipboard"))})).catch((()=>{(0,s.Iw)((0,c.t)("Failed to copy function name to clipboard"))}))}),[]);return(0,g.BX)(Y,{ref:ee,children:[(0,g.tZ)($,{ref:f,onMouseDown:fe,onMouseUp:me,onMouseMove:ve,onMouseLeave:_e,onContextMenu:Se,cursor:"pan"===K?"grabbing":"default",tabIndex:1}),(0,g.tZ)($,{ref:m,pointerEvents:"none"}),(0,g.tZ)(y,{contextMenu:be,profileGroup:E,hoveredNode:ye.current,isHighlightingAllOccurences:Ce,onCopyFunctionNameClick:ke,onHighlightAllOccurencesClick:Ee,disableCallOrderSort:x}),l&&n&&h&&se&&pe?(0,g.tZ)(b.BX,{frame:pe,configSpaceCursor:se,flamegraphCanvas:l,flamegraphRenderer:n,flamegraphView:h,canvasBounds:r,platform:E.metadata.platform}):null]})}K.displayName="FlamegraphZoomView";const Y=(0,n.Z)("div",{target:"e1w58dh81"})({name:"18v3aye",styles:"display:flex;flex-direction:column;height:100%;width:100%;position:relative"}),$=(0,n.Z)("canvas",{target:"e1w58dh80"})("left:0;top:0;width:100%;height:100%;user-select:none;position:absolute;pointer-events:",(e=>e.pointerEvents||"auto"),";cursor:",(e=>e.cursor||"default"),";&:focus{outline:none;}")},"./app/components/profiling/flamegraph/interactions/useCanvasScroll.tsx":(e,t,r)=>{r.d(t,{g:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/gl/utils.ts");function i(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=(0,n.useCallback)((n=>{if(!e||!t)return;const s=Math.abs(n.deltaY)>Math.abs(n.deltaX)?"vertical":"horizontal",a=n.deltaY>0?"down":"up";t.isViewAtTopEdgeOf(t.configSpace)&&"vertical"===s&&"up"===a||t.isViewAtBottomEdgeOf(t.configSpace)&&"vertical"===s&&"down"===a||(n.preventDefault(),r.dispatch("transform config view",[(0,o.Zw)(i?0:n.deltaX,n.deltaY,t,e),t]))}),[e,t,r,i]);return s}},"./app/components/profiling/flamegraph/interactions/useCanvasZoomOrScroll.tsx":(e,t,r)=>{r.d(t,{k:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/views/profiling/utils.tsx");function i(e){let{handleWheel:t,handleScroll:r,canvas:i,setConfigSpaceCursor:s,setLastInteraction:a}=e;(0,n.useEffect)((()=>{if(!i)return;let e={current:void 0};function n(n){void 0!==e.current&&window.cancelAnimationFrame(e.current),e=(0,o.lk)((()=>{a(null)}),300),s(null),n.metaKey||n.ctrlKey?(t(n),a("zoom")):(r(n),a("scroll"))}return i.addEventListener("wheel",n),()=>{void 0!==e.current&&window.cancelAnimationFrame(e.current),i.removeEventListener("wheel",n)}}),[i,t,r,s,a])}},"./app/components/profiling/flamegraph/interactions/useDrawHoveredBorderEffect.tsx":(e,t,r)=>{r.d(t,{B:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");function i(e){let{scheduler:t,view:r,theme:i,canvas:s,renderer:a,hoveredNode:l}=e;(0,n.useEffect)((()=>{if(!s||!r||!a)return;const e=()=>{l&&a.draw([new o.UL(l.start,l.depth,l.end-l.start,1)],{BORDER_COLOR:i.COLORS.HOVERED_FRAME_BORDER_COLOR,BORDER_WIDTH:i.SIZES.HOVERED_FRAME_BORDER_WIDTH},r.fromTransformedConfigView(s.physicalSpace))};return t.registerAfterFrameCallback(e),t.draw(),()=>{t.unregisterAfterFrameCallback(e)}}),[r,s,t,l,a,i])}},"./app/components/profiling/flamegraph/interactions/useDrawSelectedBorderEffect.tsx":(e,t,r)=>{r.d(t,{B:()=>i});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");function i(e){let{scheduler:t,view:r,theme:i,canvas:s,eventKey:a,renderer:l,selectedRef:c}=e;(0,n.useEffect)((()=>{if(!s||!r||!l)return;function e(e,r){"selected"===r&&(c.current=e),t.draw()}const n=()=>{c.current&&l.draw(c.current.map((e=>new o.UL(e.start,e.depth,e.end-e.start,1))),{BORDER_COLOR:i.COLORS.SELECTED_FRAME_BORDER_COLOR,BORDER_WIDTH:i.SIZES.HIGHLIGHTED_FRAME_BORDER_WIDTH},r.fromTransformedConfigView(s.physicalSpace))};return t.on(a,e),t.registerAfterFrameCallback(n),t.draw(),()=>{t.off(a,e),t.unregisterAfterFrameCallback(n)}}),[r,s,t,l,a,i,c])}},"./app/components/profiling/flamegraph/interactions/useInteractionViewCheckPoint.tsx":(e,t,r)=>{r.d(t,{C:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts"),i=r("./app/utils/usePrevious.tsx");function s(e){let{view:t,lastInteraction:r}=e;const s=(0,i.Z)(r),a=(0,n.useRef)(null),l=(0,o.T)();(0,n.useEffect)((()=>{t&&(null===s&&r?a.current=t.configView.clone():a.current&&!a.current.equals(t.configView)&&l({type:"checkpoint",payload:t.configView.clone()}))}),[l,r,s,t])}},"./app/components/profiling/flamegraph/interactions/useWheelCenterZoom.tsx":(e,t,r)=>{r.d(t,{T:()=>s});var n=r("../node_modules/react/index.js"),o=r("../node_modules/gl-matrix/esm/vec2.js"),i=r("./app/utils/profiling/gl/utils.ts");function s(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=(0,n.useCallback)((n=>{if(!e||!t||s)return;n.preventDefault();const a=1-.01*n.deltaY*-1;r.dispatch("transform config view",[(0,i.NR)(a,o.al(n.offsetX,n.offsetY),t,e),t])}),[e,t,r,s]);return a}},"./app/components/profiling/profilingContextMenu.tsx":(e,t,r)=>{r.d(t,{Oz:()=>h,VL:()=>_,dE:()=>x,mP:()=>y,n2:()=>c,pb:()=>p,rE:()=>b});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=r("../node_modules/react/index.js"),i=r("./app/components/tooltip.tsx"),s=r("./app/icons/index.tsx"),a=r("./app/styles/space.tsx"),l=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const c=(0,n.Z)((0,o.forwardRef)(((e,t)=>(0,l.tZ)("div",{ref:t,role:"menu",...e}))),{target:"e1lv89pz11"})("position:absolute;font-size:",(e=>e.theme.fontSizeMedium),";z-index:",(e=>e.theme.zIndex.dropdown),";background:",(e=>e.theme.backgroundElevated),";border:1px solid ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:",(e=>e.theme.dropShadowHeavy),";width:auto;min-width:164px;overflow:auto;padding-bottom:",(0,a.D)(.5),";"),u=(0,n.Z)("div",{target:"e1lv89pz10"})("cursor:pointer;display:flex;align-items:center;font-weight:normal;padding:0 ",(0,a.D)(1),";border-radius:",(e=>e.theme.borderRadius),";box-sizing:border-box;background:",(e=>0===e.tabIndex?e.theme.hover:void 0),";&:focus{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.hover),";outline:none;}"),d=(0,n.Z)("label",{target:"e1lv89pz9"})({name:"1h5wbu2",styles:"display:flex;align-items:center;font-weight:normal;margin:0;cursor:pointer;flex:1 1 100%"}),p=(0,o.forwardRef)(((e,t)=>{const{children:r,checked:n,...o}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(u,{ref:t,role:"menuitem",...o,children:(0,l.BX)(d,{children:[(0,l.BX)(m,{children:[(0,l.tZ)(v,{type:"checkbox",checked:n,onChange:()=>{}}),(0,l.tZ)(s.DL,{})]}),(0,l.tZ)(g,{children:r})]})})})})),h=(0,o.forwardRef)(((e,t)=>{const{children:r,tooltip:n,...o}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(i.u,{title:n,children:(0,l.BX)(f,{disabled:e.disabled,ref:t,role:"menuitem",...o,children:[e.icon?(0,l.tZ)(m,{children:e.icon}):null,r]})})})})),f=(0,n.Z)("button",{target:"e1lv89pz8"})("border:none;display:flex;flex:1;align-items:center;padding:",(0,a.D)(.5)," ",(0,a.D)(1),";border-radius:",(e=>e.theme.borderRadius),";box-sizing:border-box;background:",(e=>0===e.tabIndex?e.theme.hover:"transparent"),"!important;pointer-events:",(e=>e.disabled?"none":void 0),";opacity:",(e=>e.disabled?.7:void 0),";&:focus{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.hover),";outline:none;}svg{margin-right:",(0,a.D)(.5),";}"),m=(0,n.Z)("div",{target:"e1lv89pz7"})("display:flex;align-items:center;height:1.4em;width:1em;gap:",(0,a.D)(1),";padding:",(0,a.D)(1)," 0;position:relative;"),g=(0,n.Z)("div",{target:"e1lv89pz6"})("position:relative;width:100%;display:flex;gap:",(0,a.D)(.5),";justify-content:space-between;padding:",(0,a.D)(.5)," 0;margin-left:",(0,a.D)(.5),";text-transform:capitalize;margin-bottom:0;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"),v=(0,n.Z)("input",{target:"e1lv89pz5"})("position:absolute;opacity:0;cursor:pointer;height:0;padding-right:",(0,a.D)(1),";&+svg{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);width:1em;height:1.4em;display:none;}&:checked+svg{display:block;}"),_=(0,n.Z)((0,o.forwardRef)(((e,t)=>{const{children:r,...n}=e;return(0,l.tZ)(w,{children:(0,l.tZ)(u,{ref:t,role:"menuitem",...n,children:(0,l.tZ)(g,{children:r})})})})),{target:"e1lv89pz4"})("cursor:pointer;color:",(e=>e.theme.textColor),";background:transparent;padding:0 ",(0,a.D)(.5),";&:focus{outline:none;}&:active:{background:transparent;}"),w=(0,n.Z)("div",{target:"e1lv89pz3"})("padding:0 ",(0,a.D)(.5),";display:flex;>span{display:flex;}>div,>span,button{flex:1;}"),x=(0,n.Z)("div",{target:"e1lv89pz2"})("padding-top:0;padding-bottom:",(0,a.D)(1),";&:last-of-type{padding-bottom:0;}"),y=(0,n.Z)((e=>{const{children:t,...r}=e;return(0,l.tZ)("div",{...r,children:t})}),{target:"e1lv89pz1"})("text-transform:uppercase;line-height:1.5;font-weight:600;color:",(e=>e.theme.subText),";margin-bottom:0;cursor:default;font-size:75%;padding:",(0,a.D)(.5)," ",(0,a.D)(1.5),";"),b=(0,n.Z)("div",{target:"e1lv89pz0"})("width:100%;height:100%;position:absolute;left:0;top:0;z-index:",(e=>e.theme.zIndex.dropdown-1),";")},"./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx":(e,t,r)=>{r.d(t,{a$:()=>i,HK:()=>l,J_:()=>a,YY:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/speedscope.tsx");const i={profiles:{selectedRoot:null,threadId:null,highlightFrames:null},position:{view:o.UL.Empty()},preferences:{timelines:{ui_frames:!0,minimap:!0,transaction_spans:!0},colorCoding:"by system vs application frame",sorting:"call order",view:"top down",layout:"table bottom"},search:{index:null,results:{frames:new Map,spans:new Map},query:""}},s=function(e){const t=Object.keys(e);return(r,n)=>{const o={};for(const i of t)o[i]=e[i](r[i],n);return o}}({profiles:function(e,t){switch(t.type){case"set highlight all frames":return{...e,highlightFrames:t.payload};case"set selected root":return{...e,selectedRoot:t.payload};case"set thread id":return{...e,selectedRoot:null,threadId:t.payload};default:return e}},position:function(e,t){return"checkpoint"===t.type?{view:o.UL.From(t.payload)}:e},preferences:function(e,t){switch(t.type){case"set layout":return{...e,layout:t.payload};case"set color coding":return{...e,colorCoding:t.payload};case"set sorting":return{...e,sorting:t.payload};case"set view":return{...e,view:t.payload};case"toggle timeline":return{...e,timelines:{...e.timelines,[t.payload.timeline]:t.payload.value}};default:return e}},search:function(e,t){switch(t.type){case"clear search":return{...e,query:"",index:null,results:{frames:new Map,spans:new Map}};case"set results":return{...e,...t.payload};case"set search index position":return{...e,index:t.payload};default:return e}}}),a=(0,n.createContext)(null),l=(0,n.createContext)(null)},"./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContextProvider.tsx":(e,t,r)=>{r.d(t,{H:()=>a});var n=r("../node_modules/react/index.js");r("../node_modules/core-js/modules/es.error.cause.js");var o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx"),i=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(e){return!!e&&("string"==typeof e.name||"string"==typeof e.package)}function a(e){const[t,r,{nextState:a,previousState:l}]=function(e,t){const[r,o]=(0,n.useReducer)(function(e){return(t,r)=>{if(function(e){return!!e.type&&("undo"===e.type||"redo"===e.type)}(r))return function(e,t){if("undo"===t.type)return void 0===e.previous?e:e.previous;if("redo"===t.type)return void 0===e.next?e:e.next;throw new Error("Unreachable case")}(t,r);const n={next:void 0,previous:t,current:e(t.current,r)};return t.next=n,n}}(e),{current:t,previous:void 0,next:void 0});return(0,n.useMemo)((()=>[r.current,o,{previousState:r.previous?.current,nextState:r.next?.current}]),[r,o])}(o.YY,{profiles:{highlightFrames:s((c=e.initialState)?.profiles?.highlightFrames)?{name:void 0,package:void 0,...c?.profiles?.highlightFrames}:s(o.a$.profiles.highlightFrames)?o.a$.profiles.highlightFrames:null,selectedRoot:null,threadId:c?.profiles?.threadId??o.a$.profiles.threadId},position:{view:c?.position?.view??o.a$.position.view},preferences:{timelines:{...o.a$.preferences.timelines,...c?.preferences?.timelines??{}},layout:c?.preferences?.layout??o.a$.preferences.layout,colorCoding:c?.preferences?.colorCoding??o.a$.preferences.colorCoding,sorting:c?.preferences?.sorting??o.a$.preferences.sorting,view:c?.preferences?.view??o.a$.preferences.view},search:{...o.a$.search,query:c?.search?.query??o.a$.search.query}});var c;const u=(0,n.useMemo)((()=>[t,{nextState:a,previousState:l}]),[t,a,l]);return(0,i.tZ)(o.J_.Provider,{value:u,children:(0,i.tZ)(o.HK.Provider,{value:r,children:e.children})})}a.displayName="FlamegraphStateProvider"},"./app/utils/profiling/flamegraph/hooks/useFlamegraphPreferences.ts":(e,t,r)=>{r.d(t,{K:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphPreferences called outside of FlamegraphStateProvider");return e[0].preferences}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphProfiles.tsx":(e,t,r)=>{r.d(t,{X:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphProfiles called outside of FlamegraphStateProvider");return e[0].profiles}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphSearch.ts":(e,t,r)=>{r.d(t,{f:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphSearch called outside of FlamegraphStateProvider");return e[0].search}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphState.ts":(e,t,r)=>{r.d(t,{I:()=>i,T:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e}function s(){const e=(0,n.useContext)(o.HK);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e}},"./app/utils/profiling/flamegraph/hooks/useFlamegraphZoomPosition.tsx":(e,t,r)=>{r.d(t,{I:()=>i}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphContext.tsx");function i(){const e=(0,n.useContext)(o.J_);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e[0].position}},"./app/utils/profiling/hooks/useContextMenu.tsx":(e,t,r)=>{r.d(t,{a:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/profiling/colors/utils.tsx"),i=r("./app/utils/profiling/speedscope.tsx");function s(e){let{container:t}=e;const[r,s]=(0,n.useState)(!1),[a,l]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(null),h=function(){const[e,t]=(0,n.useState)(null),r=[],{tabIndex:o,setTabIndex:i,onKeyDown:s}=function(e){const[t,r]=(0,n.useState)(null),o=(0,n.useCallback)((n=>{0!==e.length&&("Escape"===n.key&&r(null),"ArrowDown"!==n.key&&"Tab"!==n.key||(n.preventDefault(),t===e.length-1||null===t?r(0):r((t??0)+1)),("ArrowUp"===n.key||"Tab"===n.key&&n.shiftKey)&&(n.preventDefault(),r(0===t||null===t?e.length-1:(t??0)-1)))}),[t,e]);return{tabIndex:t,setTabIndex:r,onKeyDown:o}}(r);return(0,n.useEffect)((()=>{e&&null===o&&e.focus()}),[e,o]),{menuRef:e,getItemProps:function(){const e=r.length;return r.push({id:e,node:null}),{tabIndex:o===e?0:-1,ref:t=>{r[e]&&(o===e&&t?.focus(),r[e].node=t)},onMouseOver:()=>{i(e)},onMouseEnter:()=>{i(e)},onKeyDown:s}},getMenuProps:function(){return{tabIndex:-1,ref:t,onKeyDown:s}},tabIndex:o,setTabIndex:i}}(),f=(0,n.useCallback)((e=>{e||h.setTabIndex(null),s(e)}),[h]),m=(0,n.useCallback)((()=>{const e=h.getMenuProps();return{...e,onKeyDown:t=>{"Escape"===t.key&&f(!1),e.onKeyDown(t)}}}),[h,f]),g=(0,n.useCallback)((function(){let{onClick:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=h.getItemProps();return{...t,onClick:t=>{t.preventDefault(),e?.()},onKeyDown:r=>{"Escape"===r.key&&f(!1),"Enter"===r.key&&e?.(),t.onKeyDown(r)}}}),[h,f]),v=(0,n.useCallback)((e=>{if(!t)return;e.preventDefault(),e.stopPropagation();const r=t.getBoundingClientRect();u(new i.UL(e.clientX-r.left,e.clientY-r.top,0,0)),f(!0)}),[f,t]);(0,n.useEffect)((()=>{const e=e=>{h.menuRef&&!h.menuRef.contains(e.target)&&s(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[h.menuRef]),(0,n.useEffect)((()=>{if(!h.menuRef)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;l(new i.UL(0,0,t.width,t.height))}));return e.observe(h.menuRef),()=>{e.disconnect()}}),[h.menuRef]),(0,n.useEffect)((()=>{if(!t)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;p(new i.UL(0,0,t.width,t.height))}));return e.observe(t),()=>{e.disconnect()}}),[t]);const _=c&&d&&a?function(e,t,r){const n=Math.floor(t.height-r.height),i=t.top,s=t.left,a=Math.floor(t.right-r.width);return{left:(0,o.uZ)(e.x+6,s,a),top:(0,o.uZ)(e.y+6,i,n)}}(c,d,a):null;return{open:r,setOpen:f,position:_,containerCoordinates:d,contextMenuCoordinates:_,menuRef:h.menuRef,handleContextMenu:v,getMenuProps:m,getMenuItemProps:g}}r("../node_modules/core-js/modules/es.array.push.js")},"./app/utils/profiling/hooks/useCurrentProjectFromRouteParam.tsx":(e,t,r)=>{r.d(t,{y:()=>i});var n=r("./app/utils/useParams.tsx"),o=r("./app/utils/useProjects.tsx");function i(){const e=(0,n.U)();return(0,o.Z)({limit:1,slugs:[e?.projectId]}).projects?.[0]??null}},"./app/utils/profiling/renderers/flamegraphRendererWebGL.tsx":(e,t,r)=>{r.d(t,{l:()=>f});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(r("../node_modules/core-js/modules/es.typed-array.at.js"),r("../node_modules/core-js/modules/es.typed-array.fill.js"),r("../node_modules/core-js/modules/es.typed-array.find-last.js"),r("../node_modules/core-js/modules/es.typed-array.find-last-index.js"),r("../node_modules/core-js/modules/es.typed-array.set.js"),r("../node_modules/core-js/modules/es.typed-array.sort.js"),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/gl-matrix/esm/mat3.js")),i=r("./app/utils/profiling/flamegraphFrame.tsx"),s=r("./app/utils/profiling/gl/utils.ts"),a=r("./app/utils/profiling/renderers/flamegraphRenderer.tsx"),l=r("./app/utils/profiling/speedscope.tsx"),c=r("./app/utils/profiling/renderers/shaders.tsx");const u=new l.UL(0,0,1,1),d=o.Ue(),p=new Float32Array(6).fill(1),h=new Float32Array(6).fill(0);class f extends a.o{constructor(e,t,r){if(super(e,t,r,arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.r),(0,n.Z)(this,"gl",null),(0,n.Z)(this,"program",null),(0,n.Z)(this,"positions",new Float32Array),(0,n.Z)(this,"bounds",new Float32Array),(0,n.Z)(this,"colors",new Float32Array),(0,n.Z)(this,"searchResults",new Float32Array),(0,n.Z)(this,"lastDragPosition",null),(0,n.Z)(this,"attributes",{a_position:null,a_color:null,a_bounds:null,a_is_search_result:null}),(0,n.Z)(this,"uniforms",{u_border_width:null,u_draw_border:null,u_model:null,u_grayscale:null,u_projection:null}),24*this.frames.length!==this.colorBuffer.length)throw new Error("Color buffer length does not match the number of vertices");this.colors=new Float32Array(this.colorBuffer),this.initCanvasContext(),this.initVertices(),this.initShaders()}initVertices(){const e=this.frames.length;this.bounds=new Float32Array(24*e),this.positions=new Float32Array(12*e),this.searchResults=new Float32Array(6*e);for(let t=0;t<e;t++){const e=this.frames[t],r=e.start,n=e.end,o=e.depth,i=e.depth+1,s=12*t;this.positions[s]=r,this.positions[s+1]=o,this.positions[s+2]=n,this.positions[s+3]=o,this.positions[s+4]=r,this.positions[s+5]=i,this.positions[s+6]=r,this.positions[s+7]=i,this.positions[s+8]=n,this.positions[s+9]=o,this.positions[s+10]=n,this.positions[s+11]=i;const a=6*t*4;for(let e=0;e<6;e++){const t=a+4*e;this.bounds[t]=r,this.bounds[t+1]=o,this.bounds[t+2]=n,this.bounds[t+3]=i}}}initCanvasContext(){if(!this.canvas)throw new Error("Cannot initialize context from null canvas");if(this.gl=(0,s.fw)(this.canvas,"webgl"),!this.gl)throw new Error("Uninitialized WebGL context");this.gl.enable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),(0,s.Lo)(this.canvas)}initShaders(){if(!this.gl)throw new Error("Uninitialized WebGL context");this.uniforms={u_border_width:null,u_draw_border:null,u_grayscale:null,u_model:null,u_projection:null},this.attributes={a_bounds:null,a_color:null,a_is_search_result:null,a_position:null};const e=(0,s.ef)(this.gl,this.gl.VERTEX_SHADER,(0,c.uf)()),t=(0,s.ef)(this.gl,this.gl.FRAGMENT_SHADER,(0,c.Dx)(this.theme));this.program=(0,s.HO)(this.gl,e,t);for(const e in this.uniforms)this.uniforms[e]=(0,s.DL)(this.gl,this.program,e);this.attributes.a_is_search_result=(0,s.IL)(this.gl,this.program,"a_is_search_result"),(0,s.Xi)(this.gl,this.searchResults,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_is_search_result,{size:1,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_color=(0,s.IL)(this.gl,this.program,"a_color"),(0,s.Xi)(this.gl,this.colors,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_color,{size:4,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_position=(0,s.IL)(this.gl,this.program,"a_position"),(0,s.Xi)(this.gl,this.positions,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_position,{size:2,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.attributes.a_bounds=(0,s.IL)(this.gl,this.program,"a_bounds"),(0,s.Xi)(this.gl,this.bounds,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_bounds,{size:4,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0}),this.gl.useProgram(this.program),this.gl.uniform1i(this.uniforms.u_draw_border,this.options.draw_border?1:0),this.gl.uniform1i(this.uniforms.u_grayscale,0)}setHighlightedFrames(e){if(!this.program||!this.gl)return;if(this.gl.uniform1i(this.uniforms.u_grayscale,e&&e.length>0?1:0),!e)return void this.updateSearchResultsBuffer(new Map);const t=e?e?.reduce(((e,t)=>(e.set((0,i.M)(t),!0),e)),new Map):new Map;this.updateSearchResultsBuffer(t)}setSearchResults(e,t){this.program&&this.gl&&(this.gl.uniform1i(this.uniforms.u_grayscale,e.length>0?1:0),this.updateSearchResultsBuffer(t))}updateSearchResultsBuffer(e){if(this.program&&this.gl){for(let t=0;t<this.frames.length;t++)this.searchResults.set(e.has((0,i.M)(this.frames[t]))?p:h,6*t);this.attributes.a_is_search_result=(0,s.IL)(this.gl,this.program,"a_is_search_result"),(0,s.Xi)(this.gl,this.searchResults,this.gl.STATIC_DRAW),(0,s.FW)(this.gl,this.attributes.a_is_search_result,{size:1,type:this.gl.FLOAT,normalized:!1,stride:0,offset:0})}}draw(e){if(!this.gl)throw new Error("Uninitialized WebGL context");if(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),!this.positions.length||!this.program)return;const t=(0,s.AN)(this.gl.canvas.width,this.gl.canvas.height);this.gl.uniformMatrix3fv(this.uniforms.u_projection,!1,t),this.gl.uniformMatrix3fv(this.uniforms.u_model,!1,e),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);const r=o.U_(d,e),n=u.transformRect(r);this.gl.uniform2f(this.uniforms.u_border_width,n.width,n.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.frames.length)}}},"./app/utils/profiling/renderers/selectedFrameRenderer.tsx":(e,t,r)=>{r.d(t,{d:()=>i});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("./app/utils/profiling/gl/utils.ts");class i{constructor(e){(0,n.Z)(this,"canvas",void 0),(0,n.Z)(this,"context",void 0),this.canvas=e,this.context=(0,o.fw)(e,"2d")}draw(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.context;n.strokeStyle=t.BORDER_COLOR,n.lineWidth=t.BORDER_WIDTH;for(let o=0;o<e.length;o++){const i=e[o].transformRect(r);n.beginPath(),n.strokeRect(i.x+t.BORDER_WIDTH,i.y+t.BORDER_WIDTH,i.width-2*t.BORDER_WIDTH,i.height-2*t.BORDER_WIDTH)}}}},"./app/utils/profiling/renderers/shaders.tsx":(e,t,r)=>{r.d(t,{Dx:()=>o,TF:()=>i,uf:()=>n,x7:()=>s});const n=()=>"\nattribute vec2 a_position;\nattribute vec4 a_color;\nattribute vec4 a_bounds;\nattribute float a_is_search_result;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying vec4 v_color;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\nvarying float v_is_search_result;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_color = a_color;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n  v_is_search_result = a_is_search_result;\n}\n",o=e=>`\nprecision mediump float;\n\nuniform vec2 u_border_width;\nuniform bool u_draw_border;\nuniform bool u_grayscale;\n\nvarying vec4 v_color;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\nvarying float v_is_search_result;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n\n  vec4 color = vec4(v_color);\n\n  if(u_grayscale && v_is_search_result == 0.0) {\n    color = vec4(${e.COLORS.FRAME_GRAYSCALE_COLOR.join(",")});\n  }\n\n  if (u_draw_border) {\n    if(width <= u_border_width.x) {\n      if(v_pos.y > minY && v_pos.y < maxY){\n        gl_FragColor = color;\n      } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      }\n    } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n      gl_FragColor = color;\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else {\n    gl_FragColor = color;\n  }\n}\n`,i=()=>"\nattribute vec2 a_position;\nattribute float a_frame_type;\nattribute vec4 a_bounds;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying float v_frame_type;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_frame_type = a_frame_type;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n}\n",s=e=>`\nprecision mediump float;\n\nuniform vec2 u_border_width;\n\nvarying float v_frame_type;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n\n  if(v_frame_type == 1.0) {\n    color = vec4(${e.COLORS.UI_FRAME_COLOR_FROZEN.join(",")});\n  } else {\n    color = vec4(${e.COLORS.UI_FRAME_COLOR_SLOW.join(",")});\n  }\n\n  if(width <= u_border_width.x) {\n    if(v_pos.y > minY && v_pos.y < maxY){\n      gl_FragColor = color;\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n    gl_FragColor = color;\n  } else {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n  }\n}\n`},"./app/utils/useDevicePixelRatio.tsx":(e,t,r)=>{r.d(t,{j:()=>o});var n=r("../node_modules/react/index.js");function o(){const[e,t]=(0,n.useState)(window.devicePixelRatio),r=(0,n.useCallback)((()=>{t(window.devicePixelRatio)}),[]);return(0,n.useLayoutEffect)((()=>(window.matchMedia(`(resolution: ${e}dppx)`).addEventListener("change",r,{once:!0}),()=>{window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).removeEventListener("change",r)})),[e,r]),e}},"./app/utils/useMemoWithPrevious.ts":(e,t,r)=>{r.d(t,{P:()=>s});var n=r("../node_modules/react/index.js"),o=r("./app/utils/useEffectAfterFirstRender.ts"),i=r("./app/utils/usePrevious.tsx");const s=(e,t)=>{const[r,s]=(0,n.useState)((()=>e(null))),a=(0,i.Z)(r);return(0,o.K)((()=>{s(e(a))}),t),r}},"./app/views/profiling/utils.tsx":(e,t,r)=>{r.d(t,{NN:()=>s,lk:()=>i}),r("./app/components/gridEditable/sortLink.tsx");var n=r("./app/locale.tsx");r("./app/utils.tsx"),r("./app/utils/queryString.tsx");const o={version:(0,n.t)("App Version"),device_manufacturer:(0,n.t)("Device Manufacturer"),device_model:(0,n.t)("Device Model"),device_os_version:(0,n.t)("Device Os Version"),transaction_name:(0,n.t)("Transaction Name")};function i(e,t){const r={current:0},n=performance.now();return r.current=window.requestAnimationFrame((function o(){r.current&&window.cancelAnimationFrame(r.current),performance.now()-n>t?e():r.current=window.requestAnimationFrame(o)})),r}Object.entries(o).map((e=>{let[t,r]=e;return{label:r,value:t}}));const s={start:null,end:null,utc:!1,period:"24h"}}}]);
//# sourceMappingURL=../sourcemaps/app_components_profiling_flamegraph_flamegraphZoomView_tsx-app_utils_profiling_flamegraph_fla-910efc.cb75388b9d3781b9ae78bf218a18f15e.js.map