"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_replays_replayContext_tsx-app_components_replays_utils_tsx-app_utils_replays_r-3d9f8f"],{"./app/components/replays/replayContext.tsx":(e,t,r)=>{r.d(t,{z:()=>T,M:()=>b});var n=r("../node_modules/react/index.js"),a=r("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),s=r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"),i=r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/types.js"),o=r("./app/stores/configStore.tsx"),l=r("./app/stores/useLegacyStore.tsx"),u=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),c=r("./app/utils/localStorage.tsx");const p=new Map;function m(e){let{replayer:t,nodeId:r}=e;if(!p.has(r))return!1;const n=p.get(r);return!(!n||!t.wrapper.contains(n.canvas)||(t.wrapper.removeChild(n.canvas),p.delete(r),0))}var d,f=r("./app/utils/useOrganization.tsx"),g=r("./app/utils/usePrevious.tsx"),v=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(e){e.ReplayConfig="replay-config"}(d||(d={}));const h=(0,n.createContext)({clearAllHighlights:()=>{},currentHoverTime:void 0,currentTime:0,dimensions:{height:0,width:0},fastForwardSpeed:0,highlight:()=>{},initRoot:()=>{},isBuffering:!1,isFetching:!1,isFinished:!1,isPlaying:!1,isSkippingInactive:!0,removeHighlight:()=>{},replay:null,restart:()=>{},setCurrentHoverTime:()=>{},setCurrentTime:()=>{},setSpeed:()=>{},speed:1,togglePlayPause:()=>{},toggleSkipInactive:()=>{}});function y(e){c.Z.setItem(d.ReplayConfig,JSON.stringify(e))}function T(e){let{children:t,initialTimeOffset:r=0,isFetching:T,replay:b,value:w={}}=e;const k=(0,l.X)(o.Z),S=(0,f.Z)(),C=b?.getRRWebEvents(),x=(0,n.useRef)(JSON.parse(c.Z.getItem(d.ReplayConfig)||"{}")),_=(0,a.u)(),I=(0,g.Z)(C),R=C!==I,j=(0,n.useRef)(null),[N,E]=(0,n.useState)({height:0,width:0}),[M,D]=(0,n.useState)(),[O,A]=(0,n.useState)(!1),[F,P]=(0,n.useState)(-1),[H,B]=(0,n.useState)(x.current.skip??!0),[U,L]=(0,n.useState)(x.current.speed||1),[Z,z]=(0,n.useState)(0),[W,q]=(0,n.useState)({target:-1,previous:-1}),$=(0,n.useRef)(void 0),G=(0,n.useRef)(!1),J=j.current?.getCurrentTime()===F,V=e=>{E(e)},X=e=>{z(e.speed)},K=()=>{z(0)},Q=(0,n.useCallback)((e=>{let{nodeId:t,annotation:r}=e;const n=j.current;n&&function(e){let{replayer:t,nodeId:r,annotation:n="",color:a}=e;const{mouseTail:s,wrapper:i}=t,o=t.getMirror().getNode(r);if(!o||!("getBoundingClientRect"in o)||!t.iframe.contentDocument?.body?.contains(o))return null;const{top:l,left:u,width:c,height:m}=o.getBoundingClientRect(),d=a??"rgba(168, 196, 236, 0.75)",f=s.cloneNode(),g=f.getContext("2d");if(!g)return null;g.fillStyle=d,g.fillRect(u,l,c,m),g.beginPath(),g.setLineDash([5,5]),g.moveTo(u,l),g.lineTo(u+c,l),g.lineTo(u+c,l+m),g.lineTo(u,l+m),g.closePath(),g.stroke(),g.font="24px Rubik",g.textAlign="right",g.textBaseline="bottom";const v=g.measureText(n).width;g.fillStyle="rgba(30, 30, 30, 0.75)",g.fillRect(u+c-v,l+m-30,v,30),g.fillStyle="white",g.fillText(n,u+c,l+m),p.set(r,{canvas:f}),i.insertBefore(f,s)}({replayer:n,nodeId:t,annotation:r})}),[]),Y=(0,n.useCallback)((()=>{const e=j.current;e&&function(e){let{replayer:t}=e;for(const e of p.keys())m({replayer:t,nodeId:e})}({replayer:e})}),[]),ee=(0,n.useCallback)((e=>{let{nodeId:t}=e;const r=j.current;r&&m({replayer:r,nodeId:t})}),[]),te=(0,n.useCallback)((()=>{P(j.current?.getCurrentTime()??-1),A(!1)}),[]),re=(0,n.useCallback)((e=>{if(void 0===C)return;if(null===e)return;if(T)return;if(j.current){if(!R&&!G.current)return;if(0===j.current.iframe.contentDocument?.body.childElementCount)return;for(;e.firstChild;)e.removeChild(e.firstChild)}const t=new s.x(C,{root:e,blockClass:"sentry-block",mouseTail:{duration:750,lineCap:"round",lineWidth:2,strokeStyle:_.purple200},skipInactive:x.current.skip??!0,speed:x.current.speed||1});t.on(i.SA.Resize,V),t.on(i.SA.Finish,te),t.on(i.SA.SkipStart,X),t.on(i.SA.SkipEnd,K),j.current=t,G.current&&(G.current=!1)}),[C,T,_.purple200,te,R]),ne=(0,n.useCallback)((()=>j.current?Math.max(j.current.getCurrentTime(),0):0),[]),ae=(0,n.useCallback)((e=>{const t=j.current;if(!t)return;const r=t.config;r&&t.setConfig({skipInactive:!1});const n=j.current?.getMetaData().totalTime,a=e>n?0:e;q({target:a,previous:ne()}),$.current&&window.clearTimeout($.current),r&&t.setConfig({skipInactive:!0}),O?($.current=window.setTimeout((()=>t.play(a)),0),A(!0)):($.current=window.setTimeout((()=>t.pause(a)),0),A(!1))}),[ne,O]),se=(0,n.useCallback)((e=>{const t=j.current;x.current={...x.current,speed:e},y(x.current),t&&(O?(t.pause(),t.setConfig({speed:e}),t.play(ne())):t.setConfig({speed:e}),L(e))}),[ne,O]),ie=(0,n.useCallback)((e=>{const t=j.current;t&&(e?t.play(ne()):t.pause(ne()),A(e),(0,u.Z)("replay.play-pause",{organization:S,user_email:k.user.email,play:e}))}),[ne,k.user.email,S]);(0,n.useEffect)((()=>{const e=()=>{"visible"!==document.visibilityState&&ie(!1)};return j.current&&C&&(re(j.current.wrapper.parentElement),document.addEventListener("visibilitychange",e)),()=>{document.removeEventListener("visibilitychange",e)}}),[re,C,ie]);const oe=(0,n.useCallback)((()=>{j.current&&(j.current.play(0),A(!0))}),[]),le=(0,n.useCallback)((e=>{const t=j.current;x.current={...x.current,skip:e},y(x.current),t&&(e!==t.config.skipInactive&&t.setConfig({skipInactive:e}),B(e))}),[]);(0,n.useEffect)((()=>(r&&C&&j.current&&ae(1e3*r),()=>{G.current=!0})),[C,j.current]);const ue=function(e){const[t,r]=(0,n.useState)(0);return function(e){(0,n.useEffect)((()=>{const t=window.requestAnimationFrame(e);return()=>window.cancelAnimationFrame(t)}),[e])}((()=>r(e))),t}(ne),[ce,pe]=-1!==W.target&&W.previous===ue&&W.target!==W.previous?[!0,W.target]:[!1,ue];return(0,n.useEffect)((()=>{ce||-1===W.target||q({target:-1,previous:-1})}),[ce,W.target]),(0,v.tZ)(h.Provider,{value:{clearAllHighlights:Y,currentHoverTime:M,currentTime:pe,dimensions:N,fastForwardSpeed:Z,highlight:Q,initRoot:re,isBuffering:ce,isFetching:T,isFinished:J,isPlaying:O,isSkippingInactive:H,removeHighlight:ee,replay:b,restart:oe,setCurrentHoverTime:D,setCurrentTime:ae,setSpeed:se,speed:U,togglePlayPause:ie,toggleSkipInactive:le,...w},children:t})}T.displayName="Provider";const b=()=>(0,n.useContext)(h)},"./app/components/replays/utils.tsx":(e,t,r)=>{r.d(t,{DF:()=>l,DR:()=>u,NH:()=>s,PE:()=>p,Ul:()=>i,cs:()=>m,mr:()=>o}),r("../node_modules/core-js/modules/es.array.push.js");var n=r("./app/utils/formatters.tsx");const a=36e5;function s(e,t){return Math.abs(new Date(e).getTime()-t)}function i(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o(s(e,t),r)}function o(e,t){if(e<=0||isNaN(e))return t?"00:00.000":"00:00";const r=e/1e3;return(0,n.HE)(t?r:Math.floor(r))}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=Math.floor(t/r);const s=e-n*t>0?1:0;n-=s;const i=[1*a,18e5,12e5,9e5,6e5,3e5,12e4,6e4,3e4,1e4,5e3,1e3],o=i.reduce(((t,r)=>(t.set(r,Math.floor(e/r)),t)),new Map),[l,u]=Array.from(o.entries()).filter((e=>{let[t,r]=e;return r<=n})).reduce(((e,t)=>t[1]>e[1]?t:e),[0,0]),c=(e-l*u)/l;return{timespan:l,cols:u,remaining:c}}function u(e,t,r,n){const a=isNaN(t)?1:t;return r.map((t=>{const{timestamp:r}=t,s=+new Date(String(r)),i=isNaN(s)?0:s-e,o=Math.floor(i/a*(n-1))+1;return[Math.max(1,o),t]})).reduce(((e,t)=>{let[r,n]=t;return e.has(r)?e.get(r)?.push(n):e.set(r,[n]),e}),new Map)}function c(e,t){const r=e.startTimestamp<=t.startTimestamp&&t.startTimestamp<=e.endTimestamp,n=e.startTimestamp<=t.endTimestamp&&t.endTimestamp<=e.endTimestamp;return r||n}function p(e){if(!e.length)return[];const t=e.map((e=>{const t=1e3*e.startTimestamp,r=1e3*e.endTimestamp;return{spanCount:1,startTimestamp:t,endTimestamp:r,duration:r-t}})),[r,...n]=t,a=[r];for(const e of n){let t=!1;for(const r of a)if(c(r,e)){t=!0,r.spanCount+=1,r.startTimestamp=Math.min(r.startTimestamp,e.startTimestamp),r.endTimestamp=Math.max(r.endTimestamp,e.endTimestamp),r.duration=r.endTimestamp-r.startTimestamp;break}t||a.push(e)}return a}function m(e,t){return void 0===t||isNaN(t)||0===t?0:e/t}},"./app/utils/replays/replayDataUtils.tsx":(e,t,r)=>{r.d(t,{Hs:()=>u,_O:()=>v,ay:()=>f,c_:()=>m,iz:()=>y,j1:()=>p,qC:()=>d,qI:()=>c,so:()=>g}),r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/core-js/modules/es.array.includes.js");var n=r("../node_modules/lodash/first.js"),a=r.n(n),s=r("../node_modules/moment/moment.js"),i=r("./app/components/events/interfaces/breadcrumbs/utils.tsx"),o=r("./app/locale.tsx"),l=r("./app/types/breadcrumbs.tsx");function u(e){const t={breadcrumbs:[],rrwebEvents:[],spans:[]};return e.forEach((e=>{"performanceSpan"===e.data?.tag?t.spans.push(e.data.payload):"breadcrumb"===e?.data?.tag?t.breadcrumbs.push(e.data.payload):t.rrwebEvents.push(e)})),t}const c=e=>"memory"===e.op,p=e=>e.op.startsWith("navigation.")||e.op.startsWith("resource."),m=(e,t)=>e.filter(l.T5).filter((e=>t.includes(e.category||"")));function d(e){const t={...e.tags,...e.browser?.name?{"browser.name":[e.browser.name]}:{},...e.browser?.version?{"browser.version":[e.browser.version]}:{},...e.device?.brand?{"device.brand":[e.device.brand]}:{},...e.device?.family?{"device.family":[e.device.family]}:{},...e.device?.model_id?{"device.model_id":[e.device.model_id]}:{},...e.device?.name?{"device.name":[e.device.name]}:{},...e.platform?{platform:[e.platform]}:{},...e.releases?{releases:[...e.releases]}:{},...e.os?.name?{"os.name":[e.os.name]}:{},...e.os?.version?{"os.version":[e.os.version]}:{},...e.sdk?.name?{"sdk.name":[e.sdk.name]}:{},...e.sdk?.version?{"sdk.version":[e.sdk.version]}:{},...e.user?.ip?{"user.ip":[e.user.ip]}:{}},r=Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{});return{...e,...e.started_at?{started_at:new Date(e.started_at)}:{},...e.finished_at?{finished_at:new Date(e.finished_at)}:{},...void 0!==e.duration?{duration:(0,s.duration)(1e3*e.duration)}:{},tags:r}}function f(e,t){const r=[].concat(t).concat({type:5,timestamp:e.finished_at.getTime(),data:{tag:"replay-end"}});return r.sort(((e,t)=>e.timestamp-t.timestamp)),a()(r).timestamp=e.started_at.getTime(),r}function g(e,t,r,n){const a=["ui.focus","ui.blur"],s=e.tags.url?.join(", "),u={type:l.kS.INIT,timestamp:e.started_at.toISOString(),level:l.nU.INFO,message:s,data:{action:"replay-init",label:(0,o.t)("Start recording"),url:s}},c=t.map((e=>({type:l.kS.ERROR,level:l.nU.ERROR,category:"issue",message:e.title,data:{label:e["error.type"].join(""),eventId:e.id,groupId:e["issue.id"]||1,groupShortId:e.issue,project:e["project.name"]},timestamp:e.timestamp}))),p=n.filter((e=>["navigation.navigate","navigation.reload","largest-contentful-paint"].includes(e.op))).sort(((e,t)=>e.startTimestamp-t.startTimestamp)).map((e=>{if(e.op.startsWith("navigation")){const[,t]=e.op.split(".");return{category:"default",type:l.kS.NAVIGATION,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,message:e.description,action:t,data:{to:e.description,label:"reload"===t?(0,o.t)("Reload"):"navigate"===t?(0,o.t)("Page load"):(0,o.t)("Navigation"),...e.data}}}return{type:l.kS.DEBUG,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,category:"default",data:{action:e.op,...e.data,label:"largest-contentful-paint"===e.op?(0,o.t)("LCP"):e.op}}})),m=n.find((e=>"navigation.navigate"===e.op)),d=r.filter((e=>!a.includes(e.category||""))).map((e=>({...e,type:l.kS.DEFAULT,timestamp:new Date(1e3*e.timestamp).toISOString()})));return(0,i.LP)([...m?[]:[u],...d,...c,...p]).sort(((e,t)=>+new Date(e.timestamp||0)-+new Date(t.timestamp||0)))}function v(e){return e.sort(((e,t)=>e.startTimestamp-t.startTimestamp)).map((e=>({...e,id:`${e.description??e.op}-${e.startTimestamp}-${e.endTimestamp}`,timestamp:1e3*e.startTimestamp})))}function h(e){let t=e.length,r=1/0,n=-1/0;for(;t--;)r=e[t]<r?e[t]:r,n=e[t]>n?e[t]:n;return{min:r,max:n}}function y(e,t,r,n){const a=t.map((e=>e.timestamp)).filter(Boolean),s=r.map((e=>e.timestamp)).filter(Boolean),i=n.filter((e=>{let{op:t}=e;return"largest-contentful-paint"!==t})),o=i.map((e=>e.startTimestamp)),l=i.map((e=>e.endTimestamp)),{min:u,max:c}=h(a),{min:p,max:m}=h(s),{min:d}=h(o),{max:f}=h(l);return{startTimestampMs:Math.min(e.started_at.getTime(),u,1e3*p,1e3*d),endTimestampMs:Math.max(e.finished_at.getTime(),c,1e3*m,1e3*f)}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_replays_replayContext_tsx-app_components_replays_utils_tsx-app_utils_replays_r-3d9f8f.2efba1669a0a72ab2ead1dd7050c6977.js.map