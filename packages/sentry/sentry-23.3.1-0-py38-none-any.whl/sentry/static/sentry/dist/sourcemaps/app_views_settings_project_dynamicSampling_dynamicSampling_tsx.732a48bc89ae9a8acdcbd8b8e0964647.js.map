{"version":3,"file":"chunks/app_views_settings_project_dynamicSampling_dynamicSampling_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/organization/permissionAlert.tsx","webpack:///./app/types/sampling.tsx","webpack:///./app/views/settings/project/dynamicSampling/samplingFeedback.tsx","webpack:///./app/views/settings/project/dynamicSampling/dynamicSampling.tsx"],"sourcesContent":["import {ReactNode} from 'react';\n\nimport Access from 'sentry/components/acl/access';\nimport {Alert} from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\nimport {Organization, Scope} from 'sentry/types';\n\ntype Props = React.ComponentPropsWithoutRef<typeof Alert> & {\n  access?: Scope[];\n  message?: ReactNode;\n  organization?: Organization;\n};\n\nfunction PermissionAlert({\n  access = ['org:write'],\n  message = t(\n    'These settings can only be edited by users with the organization owner or manager role.'\n  ),\n  organization,\n  ...props\n}: Props) {\n  return (\n    <Access access={access} organization={organization}>\n      {({hasAccess}) =>\n        !hasAccess && (\n          <Alert data-test-id=\"org-permission-alert\" type=\"warning\" showIcon {...props}>\n            {message}\n          </Alert>\n        )\n      }\n    </Access>\n  );\n}\n\nexport default PermissionAlert;\n","export enum DynamicSamplingBiasType {\n  BOOST_ENVIRONMENTS = 'boostEnvironments',\n  BOOST_LATEST_RELEASES = 'boostLatestRelease',\n  BOOST_KEY_TRANSACTIONS = 'boostKeyTransactions',\n  BOOST_LOW_VOLUME_TRANSACTIONS = 'boostLowVolumeTransactions',\n  IGNORE_HEALTH_CHECKS = 'ignoreHealthChecks',\n}\n\nexport type DynamicSamplingBias = {\n  active: boolean;\n  id: DynamicSamplingBiasType;\n};\n\nenum SamplingConditionOperator {\n  /**\n   * Combine multiple sub-conditions with the operator 'and'\n   */\n  AND = 'and',\n  OR = 'or',\n}\n\ntype DynamicSamplingConditionLogicalInner = {\n  name: string;\n  op: string;\n  options: {\n    ignoreCase: boolean;\n  };\n  value: string[];\n};\n\ntype DynamicSamplingRuleCondition = {\n  inner: DynamicSamplingConditionLogicalInner[];\n  op: SamplingConditionOperator;\n};\n\nenum DynamicSamplingRuleType {\n  /**\n   * The rule applies to traces (transaction events considered in the context of a trace)\n   */\n  TRACE = 'trace',\n  /**\n   * The rule applies to transactions\n   */\n  TRANSACTION = 'transaction',\n}\n\nexport type DynamicSamplingRule = {\n  /**\n   * Indicates if the rule is enabled or not\n   */\n  active: boolean;\n  /**\n   * It is a possibly empty list of conditions to which the rule applies\n   */\n  condition: DynamicSamplingRuleCondition;\n  /**\n   * This is a unique number within a project\n   */\n  id: number;\n  /**\n   * It is the sampling rate that is applied\n   */\n  sampleRate: number;\n  /**\n   * Describes the type of rule\n   */\n  type: DynamicSamplingRuleType;\n};\n","import {Fragment, useCallback} from 'react';\nimport styled from '@emotion/styled';\n\nimport Checkbox from 'sentry/components/checkbox';\nimport {FeatureFeedback} from 'sentry/components/featureFeedback';\nimport {TextField} from 'sentry/components/forms';\nimport Textarea from 'sentry/components/forms/controls/textarea';\nimport FieldGroup from 'sentry/components/forms/fieldGroup';\nimport {t} from 'sentry/locale';\nimport ConfigStore from 'sentry/stores/configStore';\nimport {space} from 'sentry/styles/space';\n\nenum TracingCapturingPriorities {\n  TRANSACTION_NAME = 'transaction_name',\n  CUSTOM_TAG = 'custom_tag',\n  OTHER = 'other',\n}\n\ntype Option = {\n  checked: boolean;\n  title: string;\n  value: string | number;\n};\n\ntype InitialData = {\n  opinionAboutFeature: string;\n  tracingCapturingOtherPriority: string;\n  tracingCapturingPriorities: Option[];\n};\n\nconst initialData: InitialData = {\n  opinionAboutFeature: '',\n  tracingCapturingPriorities: [\n    {\n      title: t('By transaction name'),\n      value: TracingCapturingPriorities.TRANSACTION_NAME,\n      checked: false,\n    },\n    {\n      title: t('By custom tag'),\n      value: TracingCapturingPriorities.CUSTOM_TAG,\n      checked: false,\n    },\n    {\n      title: t('Other'),\n      value: TracingCapturingPriorities.OTHER,\n      checked: false,\n    },\n  ],\n  tracingCapturingOtherPriority: '',\n};\n\nfunction MultipleCheckboxField({\n  options,\n  onChange,\n  otherTextField,\n}: {\n  onChange: (options: Option[]) => void;\n  options: Option[];\n  otherTextField: React.ReactNode;\n}) {\n  const handleClick = useCallback(\n    (newOption: Option, checked: boolean) => {\n      const newOptions = options.map(option => {\n        if (option.value === newOption.value) {\n          return {\n            ...option,\n            checked,\n          };\n        }\n        return option;\n      });\n\n      onChange(newOptions);\n    },\n    [onChange, options]\n  );\n\n  return (\n    <Fragment>\n      {options.map(option => {\n        if (option.value === 'other') {\n          return (\n            <CheckboxOtherOptionWrapper key={option.value}>\n              <Checkbox onChange={e => handleClick(option, e.target.checked)} />\n              {option.title}\n              {otherTextField}\n            </CheckboxOtherOptionWrapper>\n          );\n        }\n\n        return (\n          <CheckboxOption key={option.value}>\n            <Checkbox\n              checked={option.checked}\n              onChange={e => handleClick(option, e.target.checked)}\n            />\n            {option.title}\n          </CheckboxOption>\n        );\n      })}\n    </Fragment>\n  );\n}\n\nexport function SamplingFeedback() {\n  const feedbackMessage = `Dynamic Sampling feedback by ${ConfigStore.get('user').email}`;\n\n  return (\n    <FeatureFeedback\n      featureName=\"dynamic-sampling\"\n      initialData={initialData}\n      buttonProps={{\n        priority: 'primary',\n        size: 'sm',\n      }}\n    >\n      {({Header, Body, Footer, state, onFieldChange}) => {\n        return (\n          <Fragment>\n            <Header>{t('Submit Feedback')}</Header>\n            <Body showSelfHostedMessage={false}>\n              <FieldGroup\n                label={<Label>{t('What do you think about this feature?')}</Label>}\n                stacked\n                inline={false}\n                flexibleControlStateSize\n              >\n                <Textarea\n                  name=\"opinion-about-feedback\"\n                  value={state.opinionAboutFeature}\n                  rows={5}\n                  autosize\n                  onChange={event =>\n                    onFieldChange('opinionAboutFeature', event.target.value)\n                  }\n                />\n              </FieldGroup>\n              <FieldGroup\n                label={\n                  <Label>\n                    {t(\n                      'What other priorities would you like Sentry to apply for trace capturing?'\n                    )}\n                  </Label>\n                }\n                stacked\n                inline={false}\n                flexibleControlStateSize\n              >\n                <MultipleCheckboxField\n                  options={state.tracingCapturingPriorities}\n                  onChange={newTracingCapturingPriorities => {\n                    if (\n                      newTracingCapturingPriorities.some(\n                        newTracingCapturingPriority =>\n                          newTracingCapturingPriority.value ===\n                            TracingCapturingPriorities.OTHER &&\n                          newTracingCapturingPriority.checked === false\n                      )\n                    ) {\n                      onFieldChange('tracingCapturingOtherPriority', '');\n                    }\n                    onFieldChange(\n                      'tracingCapturingPriorities',\n                      newTracingCapturingPriorities\n                    );\n                  }}\n                  otherTextField={\n                    <OtherTextField\n                      inline={false}\n                      name=\"tracingCapturingOtherPriority\"\n                      flexibleControlStateSize\n                      stacked\n                      disabled={state.tracingCapturingPriorities.some(\n                        tracingCapturingPriority =>\n                          tracingCapturingPriority.value ===\n                            TracingCapturingPriorities.OTHER &&\n                          tracingCapturingPriority.checked === false\n                      )}\n                      onClick={event => event.stopPropagation()}\n                      value={state.tracingCapturingOtherPriority}\n                      onChange={value =>\n                        onFieldChange('tracingCapturingOtherPriority', value)\n                      }\n                      placeholder={t('Please let us know which other priority')}\n                    />\n                  }\n                />\n              </FieldGroup>\n            </Body>\n            <Footer\n              primaryDisabledReason={\n                !state.opinionAboutFeature.trim() &&\n                state.tracingCapturingPriorities.every(\n                  tracingCapturingPriority => tracingCapturingPriority.checked === false\n                )\n                  ? t('Please answer at least one question')\n                  : undefined\n              }\n              submitEventData={{\n                contexts: {\n                  feedback: {\n                    opinionAboutFeature: state.opinionAboutFeature || null,\n                    tracingCapturingPriorities:\n                      state.tracingCapturingPriorities\n                        .filter(\n                          tracingCapturingPriority => tracingCapturingPriority.checked\n                        )\n                        .map(tracingCapturingPriority => tracingCapturingPriority.title)\n                        .join(', ') || null,\n                    tracingCapturingOtherPriority:\n                      state.tracingCapturingOtherPriority || null,\n                  },\n                },\n                message: state.opinionAboutFeature.trim()\n                  ? `${feedbackMessage} - ${state.opinionAboutFeature}`\n                  : feedbackMessage,\n              }}\n            />\n          </Fragment>\n        );\n      }}\n    </FeatureFeedback>\n  );\n}\n\nconst Label = styled('strong')`\n  margin-bottom: ${space(1)};\n  display: inline-block;\n`;\n\nconst CheckboxOption = styled('label')`\n  cursor: pointer;\n  display: grid;\n  grid-template-columns: max-content 1fr;\n  gap: ${space(1)};\n  align-items: center;\n  :not(:last-child) {\n    margin-bottom: ${space(1)};\n  }\n`;\n\nconst CheckboxOtherOptionWrapper = styled(CheckboxOption)`\n  grid-template-columns: max-content max-content 1fr;\n\n  @media (max-width: ${p => p.theme.breakpoints.small}) {\n    grid-template-columns: max-content 1fr;\n  }\n`;\n\nconst OtherTextField = styled(TextField)`\n  @media (max-width: ${p => p.theme.breakpoints.small}) {\n    grid-column: 1/-1;\n  }\n\n  && {\n    input {\n      ${p => p.disabled && 'cursor: pointer;'}\n    }\n  }\n`;\n","import {Fragment, useCallback, useEffect} from 'react';\nimport styled from '@emotion/styled';\n\nimport {\n  addErrorMessage,\n  addLoadingMessage,\n  addSuccessMessage,\n} from 'sentry/actionCreators/indicator';\nimport {Button} from 'sentry/components/button';\nimport FeatureBadge from 'sentry/components/featureBadge';\nimport BooleanField from 'sentry/components/forms/fields/booleanField';\nimport {Panel, PanelBody, PanelFooter, PanelHeader} from 'sentry/components/panels';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\nimport {t} from 'sentry/locale';\nimport ProjectsStore from 'sentry/stores/projectsStore';\nimport {space} from 'sentry/styles/space';\nimport {Project} from 'sentry/types';\nimport {DynamicSamplingBias, DynamicSamplingBiasType} from 'sentry/types/sampling';\nimport trackAdvancedAnalyticsEvent from 'sentry/utils/analytics/trackAdvancedAnalyticsEvent';\nimport handleXhrErrorResponse from 'sentry/utils/handleXhrErrorResponse';\nimport useApi from 'sentry/utils/useApi';\nimport useOrganization from 'sentry/utils/useOrganization';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\nimport PermissionAlert from 'sentry/views/settings/organization/permissionAlert';\n\nimport {SamplingFeedback} from './samplingFeedback';\n\nconst SERVER_SIDE_SAMPLING_DOC_LINK =\n  'https://docs.sentry.io/product/data-management-settings/dynamic-sampling/';\n\ntype Props = {\n  project: Project;\n};\n\nexport const knowDynamicSamplingBiases = {\n  [DynamicSamplingBiasType.BOOST_LATEST_RELEASES]: {\n    label: t('Prioritize new releases'),\n    help: t('Captures more transactions for your new releases as they are being adopted'),\n  },\n  [DynamicSamplingBiasType.BOOST_ENVIRONMENTS]: {\n    label: t('Prioritize dev environments'),\n    help: t(\n      'Captures more traces from environments that contain \"dev\", \"test\", \"qa\", and \"local\"'\n    ),\n  },\n  [DynamicSamplingBiasType.BOOST_KEY_TRANSACTIONS]: {\n    label: t('Prioritize key transactions'),\n    help: t('Captures more of your most important (starred) transactions'),\n  },\n  [DynamicSamplingBiasType.BOOST_LOW_VOLUME_TRANSACTIONS]: {\n    label: t('Prioritize low-volume transactions'),\n    help: t(\"Balance high-volume endpoints so they don't drown out low-volume ones\"),\n  },\n  [DynamicSamplingBiasType.IGNORE_HEALTH_CHECKS]: {\n    label: t('Deprioritize health checks'),\n    help: t('Captures fewer of your health checks transactions'),\n  },\n};\n\nexport function DynamicSampling({project}: Props) {\n  const organization = useOrganization();\n  const api = useApi();\n\n  const hasTransactionNamePriorityFlag = organization.features.includes(\n    'dynamic-sampling-transaction-name-priority'\n  );\n  const hasAccess = organization.access.includes('project:write');\n  const biases = project.dynamicSamplingBiases ?? [];\n\n  useEffect(() => {\n    trackAdvancedAnalyticsEvent('dynamic_sampling_settings.viewed', {\n      organization,\n      project_id: project.id,\n    });\n  }, [project.id, organization]);\n\n  async function handleToggle(bias: DynamicSamplingBias) {\n    addLoadingMessage();\n\n    const newDynamicSamplingBiases = biases.map(b => {\n      if (b.id === bias.id) {\n        return {...b, active: !b.active};\n      }\n      return b;\n    });\n\n    try {\n      const result = await api.requestPromise(\n        `/projects/${organization.slug}/${project.slug}/`,\n        {\n          method: 'PUT',\n          data: {\n            dynamicSamplingBiases: newDynamicSamplingBiases,\n          },\n        }\n      );\n\n      trackAdvancedAnalyticsEvent(\n        bias.active\n          ? 'dynamic_sampling_settings.priority_disabled'\n          : 'dynamic_sampling_settings.priority_enabled',\n        {\n          organization,\n          project_id: project.id,\n          id: bias.id,\n        }\n      );\n\n      ProjectsStore.onUpdateSuccess(result);\n      addSuccessMessage(t('Successfully updated dynamic sampling configuration'));\n    } catch (error) {\n      const message = t('Unable to update dynamic sampling configuration');\n      handleXhrErrorResponse(message)(error);\n      addErrorMessage(message);\n    }\n  }\n\n  const handleReadDocs = useCallback(() => {\n    trackAdvancedAnalyticsEvent('dynamic_sampling_settings.read_docs_clicked', {\n      organization,\n      project_id: project.id,\n    });\n  }, [organization, project.id]);\n\n  return (\n    <SentryDocumentTitle title={t('Dynamic Sampling')}>\n      <Fragment>\n        <SettingsPageHeader\n          title={\n            <Fragment>\n              {t('Dynamic Sampling')} <FeatureBadge type=\"new\" />\n            </Fragment>\n          }\n          action={<SamplingFeedback />}\n        />\n        <TextBlock>\n          {t(\n            'Sentry aims to capture the most valuable transactions in full detail, so you have the necessary data to resolve any performance issues.'\n          )}\n        </TextBlock>\n        <PermissionAlert\n          organization={organization}\n          access={['project:write']}\n          message={t(\n            'These settings can only be edited by users with the organization owner, manager, or admin role.'\n          )}\n        />\n        <Panel>\n          <PanelHeader>{t('Sampling Priorities')}</PanelHeader>\n          <PanelBody>\n            {Object.entries(knowDynamicSamplingBiases).map(([key, value]) => {\n              const bias = biases.find(b => b.id === key);\n\n              if (!bias) {\n                return null;\n              }\n\n              // \"Prioritize low-volume transactions\" is only available to orgs with the feature flag\n              if (\n                !hasTransactionNamePriorityFlag &&\n                key === DynamicSamplingBiasType.BOOST_LOW_VOLUME_TRANSACTIONS\n              ) {\n                return null;\n              }\n\n              return (\n                <BooleanField\n                  {...value}\n                  key={key}\n                  name={key}\n                  value={bias.active}\n                  onChange={() => handleToggle(bias)}\n                  disabled={!hasAccess}\n                  disabledReason={\n                    !hasAccess\n                      ? t('You do not have permission to edit this setting')\n                      : undefined\n                  }\n                />\n              );\n            })}\n          </PanelBody>\n          <StyledPanelFooter>\n            <Button\n              href={SERVER_SIDE_SAMPLING_DOC_LINK}\n              onClick={handleReadDocs}\n              external\n            >\n              {t('Read Docs')}\n            </Button>\n          </StyledPanelFooter>\n        </Panel>\n      </Fragment>\n    </SentryDocumentTitle>\n  );\n}\n\nconst StyledPanelFooter = styled(PanelFooter)`\n  padding: ${space(1.5)} ${space(2)};\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n"],"names":["PermissionAlert","_ref","access","message","t","organization","props","_jsx","Access","children","_ref2","hasAccess","Alert","type","showIcon","displayName","DynamicSamplingBiasType","SamplingConditionOperator","DynamicSamplingRuleType","TracingCapturingPriorities","initialData","opinionAboutFeature","tracingCapturingPriorities","title","value","TRANSACTION_NAME","checked","CUSTOM_TAG","OTHER","tracingCapturingOtherPriority","MultipleCheckboxField","options","onChange","otherTextField","handleClick","useCallback","newOption","newOptions","map","option","Fragment","_jsxs","CheckboxOtherOptionWrapper","Checkbox","e","target","CheckboxOption","SamplingFeedback","feedbackMessage","ConfigStore","email","FeatureFeedback","featureName","buttonProps","priority","size","Header","Body","Footer","state","onFieldChange","showSelfHostedMessage","FieldGroup","label","Label","stacked","inline","flexibleControlStateSize","Textarea","name","rows","autosize","event","newTracingCapturingPriorities","some","newTracingCapturingPriority","OtherTextField","disabled","tracingCapturingPriority","onClick","stopPropagation","placeholder","primaryDisabledReason","trim","every","undefined","submitEventData","contexts","feedback","filter","join","_styled","space","p","theme","breakpoints","small","TextField","knowDynamicSamplingBiases","BOOST_LATEST_RELEASES","help","BOOST_ENVIRONMENTS","BOOST_KEY_TRANSACTIONS","BOOST_LOW_VOLUME_TRANSACTIONS","IGNORE_HEALTH_CHECKS","DynamicSampling","project","useOrganization","api","useApi","hasTransactionNamePriorityFlag","features","includes","biases","dynamicSamplingBiases","useEffect","trackAdvancedAnalyticsEvent","project_id","id","handleReadDocs","SentryDocumentTitle","SettingsPageHeader","FeatureBadge","action","TextBlock","Panel","PanelHeader","PanelBody","Object","entries","key","bias","find","b","_createElement","BooleanField","active","async","addLoadingMessage","newDynamicSamplingBiases","result","requestPromise","slug","method","data","ProjectsStore","addSuccessMessage","error","handleXhrErrorResponse","addErrorMessage","handleToggle","disabledReason","StyledPanelFooter","Button","href","external","PanelFooter"],"sourceRoot":""}