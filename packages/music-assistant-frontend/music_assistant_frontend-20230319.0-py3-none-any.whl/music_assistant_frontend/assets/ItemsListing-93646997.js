import{g as ne,a4 as Se,B as se,t as Z,a5 as $e,a6 as Ae,a7 as Le,b as s,a8 as Ee,a9 as Te,m as A,aa as Be,u as De,E as Me,r as y,z as R,o as K,ab as Pe,ac as xe,h as f,q as $,ad as G,p as _,l as L,v as h,H as ie,ae as Oe,af as Ne,d as Fe,n as X,e as Re,V as F,A as z,w as u,i as E,k as ee,s as q,F as te,x as ae,j as U,U as qe}from"./index-b6297644.js";import{s as Ue}from"./vue-virtual-scroller.esm-fe950b44.js";/* empty css                             */import{L as Ke}from"./ListviewItem-326db3c5.js";import{_ as He,V as je,i as Ge,a as Xe}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-32ad9ef2.js";import{V as Ye}from"./VToolbar-b9e353fc.js";import{V as We}from"./VSelect-97ee24b5.js";import{V as Je,a as Qe}from"./VRow-12fc37e4.js";import{V as le}from"./VAlert-4a74028f.js";import{n as re,d as ue,e as Ze,g as ze,i as ce,o as et,p as de,u as me,V as x,q as tt,r as at,s as lt,v as ot,w as nt,x as st,a as B,l as it}from"./VBtn-a638fdfe.js";import{m as rt,u as ut,f as ct,c as dt,b as mt,V as P,a as vt}from"./VTooltip-138f7f67.js";import{m as ft,M as pt,V as gt,c as bt}from"./VCardText-db93722d.js";import{V as yt}from"./VCard-32859bd2.js";import{V as ht}from"./VMenu-ee0bbc98.js";import{V as kt}from"./VDivider-6186aa73.js";import{_ as wt}from"./_plugin-vue_export-helper-c27b6911.js";const _t=ne()({name:"VBadge",inheritAttrs:!1,props:{bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:Se,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...re({location:"top end"}),...ue(),...Ze(),...se(),...ft({transition:"scale-rotate-transition"})},setup(e,m){const{backgroundColorClasses:o,backgroundColorStyles:r}=ze(Z(e,"color")),{roundedClasses:V}=ce(e),{t:p}=$e(),{textColorClasses:i,textColorStyles:I}=et(Z(e,"textColor")),{themeClasses:T}=Ae(),{locationStyles:C}=de(e,!0,g=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(g)?+(e.offsetY??0):["left","right"].includes(g)?+(e.offsetX??0):0));return me(()=>{const g=Number(e.content),n=!e.max||isNaN(g)?e.content:g<=e.max?g:`${e.max}+`,[l,k]=Le(m.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return s(e.tag,A({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline}]},k),{default:()=>{var v,b;return[s("div",{class:"v-badge__wrapper"},[(b=(v=m.slots).default)==null?void 0:b.call(v),s(pt,{transition:e.transition},{default:()=>{var d,S;return[Ee(s("span",A({class:["v-badge__badge",T.value,o.value,V.value,i.value],style:[r.value,I.value,e.inline?{}:C.value],"aria-atomic":"true","aria-label":p(e.label,g),"aria-live":"polite",role:"status"},l),[e.dot?void 0:m.slots.badge?(S=(d=m.slots).badge)==null?void 0:S.call(d):e.icon?s(x,{icon:e.icon},null):n]),[[Te,e.modelValue]])]}})])]}})}),{}}});const Vt=ne()({name:"VSnackbar",props:{multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,...re({location:"bottom"}),...tt(),...ue(),...at(),...se(),...Be(rt({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},emits:{"update:modelValue":e=>!0},setup(e,m){let{slots:o}=m;const r=De(e,"modelValue"),{locationStyles:V}=de(e),{positionClasses:p}=lt(e),{scopeId:i}=ut(),{themeClasses:I}=Me(e),{colorClasses:T,colorStyles:C,variantClasses:g}=ot(e),{roundedClasses:n}=ce(e),l=y();R(r,v),R(()=>e.timeout,v),K(()=>{r.value&&v()});let k=-1;function v(){window.clearTimeout(k);const d=Number(e.timeout);!r.value||d===-1||(k=window.setTimeout(()=>{r.value=!1},d))}function b(){window.clearTimeout(k)}return me(()=>{const[d]=dt(e);return s(mt,A({ref:l,class:["v-snackbar",{"v-snackbar--active":r.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--vertical":e.vertical},p.value]},d,{modelValue:r.value,"onUpdate:modelValue":S=>r.value=S,contentProps:A({class:["v-snackbar__wrapper",I.value,T.value,n.value,g.value],style:[V.value,C.value],onPointerenter:b,onPointerleave:v},d.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0},i),{default:()=>[nt(!1,"v-snackbar"),o.default&&s("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[o.default()]),o.actions&&s(st,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[s("div",{class:"v-snackbar__actions"},[o.actions()])]})],activator:o.activator})}),ct({},l)}}),ve=(e,m)=>{const o=e.__vccOpts||e;for(const[r,V]of m)o[r]=V;return o},Ct={},It=e=>(Oe("data-v-259be2b2"),e=e(),Ne(),e),St={class:"container"},$t=It(()=>L("div",{class:"spinner"},null,-1)),At=[$t];function Lt(e,m){return f(),$("div",St,At)}const Et=ve(Ct,[["render",Lt],["__scopeId","data-v-259be2b2"],["__file","/home/oumoussa/side-projects/infinite/src/components/Spinner.vue"]]),Tt=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}}),Bt=(e,m,o)=>()=>{const r=o.parentEl||document.documentElement;o.prevHeight=r.scrollHeight,m.loading(),e("infinite",m)},Dt=(e,m)=>{const o=e.getBoundingClientRect();if(!m)return o.top>=0&&o.bottom<=window.innerHeight;const r=m.getBoundingClientRect();return o.top>=r.top&&o.bottom<=r.bottom},oe=e=>{e.parentEl=document.querySelector(e.target)||null;let m=`0px 0px ${e.distance}px 0px`;e.top&&(m=`${e.distance}px 0px 0px 0px`);const o=new IntersectionObserver(r=>{r[0].isIntersecting&&(e.firstload&&e.emit(),e.firstload=!0)},{root:e.parentEl,rootMargin:m});return o.observe(e.infiniteLoading.value),o},Mt={class:"state-error"},Pt={__name:"InfiniteLoading",props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstload:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(e,{emit:m}){const o=e;let r=null;const V=y(null),p=y("ready"),{top:i,firstload:I,target:T,distance:C}=o,{identifier:g}=Pe(o),n={infiniteLoading:V,target:T,top:i,firstload:I,distance:C,prevHeight:0,parentEl:null};n.emit=Bt(m,Tt(p),n);const l=()=>R(p,async v=>{const b=n.parentEl||document.documentElement;await ie(),v=="loaded"&&i&&(b.scrollTop=b.scrollHeight-n.prevHeight),v=="loaded"&&Dt(V.value,n.parentEl)&&n.emit(),v=="complete"&&r.disconnect()}),k=()=>R(g,()=>{p.value="ready",r.disconnect(),r=oe(n)});return K(()=>{r=oe(n),l(),g&&k()}),xe(()=>{r.disconnect()}),(v,b)=>(f(),$("div",{ref_key:"infiniteLoading",ref:V},[p.value=="loading"?G(v.$slots,"spinner",{key:0},()=>[s(Et)],!0):_("v-if",!0),p.value=="complete"?G(v.$slots,"complete",{key:1},()=>{var d;return[L("span",null,h(((d=e.slots)==null?void 0:d.complete)||"No more results!"),1)]},!0):_("v-if",!0),p.value=="error"?G(v.$slots,"error",{key:2,retry:n.emit},()=>{var d;return[L("span",Mt,[L("span",null,h(((d=e.slots)==null?void 0:d.error)||"Oops something went wrong!"),1),L("button",{class:"retry",onClick:b[0]||(b[0]=(...S)=>n.emit&&n.emit(...S))}," retry ")])]},!0):_("v-if",!0)],512))}},xt=ve(Pt,[["__scopeId","data-v-9d82030b"],["__file","/home/oumoussa/side-projects/infinite/src/components/InfiniteLoading.vue"]]);const Ot={key:0},Nt={key:0},Ft={key:1},Rt={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},qt={key:2},Ut={key:3},sa=function(e,m,o,r,V,p=!0){var C,g;let i=[];if(V){const n=V.toLowerCase();for(const l of e)(l.name.toLowerCase().includes(n)||"artist"in l&&((C=l.artist)!=null&&C.name.toLowerCase().includes(n))||"album"in l&&((g=l.album)!=null&&g.name.toLowerCase().includes(n))||"artists"in l&&l.artists&&l.artists[0].name.toLowerCase().includes(n))&&i.push(l)}else i=e;r=="sort_name"&&i.sort((n,l)=>(n.sort_name||n.name).localeCompare(l.sort_name||l.name)),r=="sort_album"&&i.sort((n,l)=>{var k,v;return(v=n.album)==null?void 0:v.name.localeCompare((k=l.album)==null?void 0:k.name)}),r=="sort_artist"&&i.sort((n,l)=>n.artists[0].name.localeCompare(l.artists[0].name)),r=="track_number"&&(i.sort((n,l)=>(n.track_number||0)-(l.track_number||0)),i.sort((n,l)=>(n.disc_number||0)-(l.disc_number||0))),r=="position"&&i.sort((n,l)=>(n.position||0)-(l.position||0)),r=="year"&&i.sort((n,l)=>(n.year||0)-(l.year||0)),r=="timestamp DESC"&&i.sort((n,l)=>(l.timestamp||0)-(n.timestamp||0)),r=="duration"&&i.sort((n,l)=>(n.duration||0)-(l.duration||0)),r=="provider"&&i.sort((n,l)=>n.provider.localeCompare(l.provider)),p&&(i=i.filter(n=>n.in_library));const I=i.length,T=i.slice(m,m+o);return{items:T,count:T.length,limit:o,offset:m,total:I}},Kt=Fe({__name:"ItemsListing",props:{itemtype:null,sortKeys:{default:()=>["sort_name","timestamp DESC"]},showTrackNumber:{type:Boolean,default:!0},showProviders:{type:Boolean,default:Object.keys(X.providers).length>1},showMenu:{type:Boolean,default:!0},showLibrary:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},updateAvailable:{type:Boolean},loadData:null},emits:["toggleAlbumArtistsOnly","refreshClicked"],setup(e,{emit:m}){const o=e,r=100,V=Re(),p=y("list"),i=y(""),I=y("sort_name"),T=y(!1),C=y(!1),g=y(!1),n=y(0),l=y([]),k=y(),v=y(!1),b=y(!1),d=y([]),S=y(!1),fe=y(!1),O=y(!1),M=y(!1),pe=function(){C.value?C.value=!1:(C.value=!0,ie(()=>{var t;(t=document.getElementById("searchInput"))==null||t.focus()}))},ge=function(t){return t<500?2:t<=500?3:t<=700?4:t<=1e3?5:t<=1200?6:t<=1500?7:t<=1700?8:t>1700?9:0},be=function(){p.value==="panel"?p.value="list":p.value="panel",localStorage.setItem(`viewMode.${o.itemtype}`,p.value)},ye=function(){b.value=!b.value;const t=b.value?"true":"false";localStorage.setItem(`libraryFilter.${o.itemtype}`,t),D(!0)},he=function(){M.value=!M.value;const t=M.value?"true":"false";localStorage.setItem(`albumArtistsFilter.${o.itemtype}`,t),m("toggleAlbumArtistsOnly",M.value),D(!0)},Y=function(t){return d.value.includes(t)},W=function(t,c){if(c)d.value.includes(t)||d.value.push(t);else for(let a=0;a<d.value.length;a++)d.value[a]===t&&d.value.splice(a,1);q.blockGlobalPlayMenu=d.value.length>0},ke=function(){d.value=[],O.value=!1,q.blockGlobalPlayMenu=!1},H=function(){d.value.length>0?S.value=!0:O.value=!O.value},we=function(t){D(!0)},j=function(t){d.value=[t],S.value=!0},_e=function(){D(!0),m("refreshClicked")},J=function(t){var a;if(!Ge(t)){j(t);return}const c=o.itemtype.includes("versions").toString();["artist","album","playlist"].includes(t.media_type)||c=="true"||!((a=q.selectedPlayer)!=null&&a.available)?V.push({name:t.media_type,params:{itemId:t.item_id,provider:t.provider,forceProviderVersion:c}}):q.selectedPlayer&&X.playMedia(t)},Ve=function(t,c){t!==void 0&&(I.value=t),localStorage.setItem(`sortBy.${o.itemtype}`,I.value),D(!0)},Ce=function(t){if(l.value.length==0){t.loaded();return}if(k.value!==void 0&&n.value>=k.value){t.loaded();return}n.value+=r,D().then(()=>{t.loaded()})},Ie=function(){localStorage.setItem("globalsearch",i.value),V.push({name:"search",params:{initSearch:i.value}})};R(()=>i.value,t=>{t&&(C.value=!0),D(!0)});const D=async function(t=!1,c=r){t&&(n.value=0,fe.value=!1),v.value=!0;const a=await o.loadData(n.value,c,I.value,i.value||"",b.value);n.value?l.value.push(...a.items):l.value=a.items,k.value=a.total,v.value=!1;let w=`search.${o.itemtype}`;o.parentItem&&(w+=o.parentItem.item_id),localStorage.setItem(w,i.value)};K(()=>{const t=localStorage.getItem(`viewMode.${o.itemtype}`);t&&t!=="null"?p.value=t:o.itemtype=="artists"||o.itemtype=="albums"?p.value="panel":p.value="list";const c=localStorage.getItem(`sortBy.${o.itemtype}`);if(c&&c!=="null"?I.value=c:I.value=o.sortKeys[0],o.showLibrary!==!1){const N=localStorage.getItem(`libraryFilter.${o.itemtype}`);N&&N=="true"&&(b.value=!0)}if(o.showAlbumArtistsOnlyFilter!==!1){const N=localStorage.getItem(`albumArtistsFilter.${o.itemtype}`);N&&N=="true"&&(M.value=!0,m("toggleAlbumArtistsOnly",M.value))}let a=`search.${o.itemtype}`;o.parentItem&&(a+=o.parentItem.item_id);const w=localStorage.getItem(a);w&&w!=="null"&&(console.log("savedSearch",w),i.value=w),D(!0)}),K(()=>{const t=X.subscribe_multi([F.MEDIA_ITEM_ADDED,F.MEDIA_ITEM_UPDATED,F.MEDIA_ITEM_DELETED],c=>{if(c.event==F.MEDIA_ITEM_DELETED)l.value=l.value.filter(a=>a.uri!=c.object_id);else if(c.event==F.MEDIA_ITEM_UPDATED){const a=c.data;l.value=l.value.map(w=>w.uri==a.uri?a:w)}});z(t)});const Q=function(t){S.value||(t.key==="a"&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),d.value=l.value):!g.value&&t.key=="Backspace"?i.value=i.value.slice(0,-1):!g.value&&t.key.length==1&&(i.value+=t.key,C.value=!0))};return document.addEventListener("keydown",Q),z(()=>{document.removeEventListener("keydown",Q)}),(t,c)=>(f(),$("section",null,[s(Ye,{density:"compact",variant:"flat",color:"transparent"},{default:u(()=>[s(P,{location:"bottom"},{activator:u(({props:a})=>[s(B,A(a,{icon:d.value.length>0?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",variant:"plain",onClick:H}),null,16,["icon"]),t.$vuetify.display.mobile?_("",!0):(f(),$("span",Ot,[!d.value.length&&k.value?(f(),$("span",{key:0,style:{cursor:"pointer"},onClick:H},h(t.$t("items_total",[k.value])),1)):d.value.length?(f(),$("span",{key:1,style:{cursor:"pointer"},onClick:H},h(t.$t("items_selected",[d.value.length])),1)):_("",!0)]))]),default:u(()=>[L("span",null,h(t.$t("tooltip.select_items")),1)]),_:1}),s(je),s(P,{location:"bottom","close-on-content-click":""},{activator:u(({props:a})=>[e.showLibrary!==!1?(f(),E(B,A({key:0},a,{icon:"",variant:"plain",onClick:ye}),{default:u(()=>[s(x,{icon:b.value?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1040)):_("",!0)]),default:u(()=>[L("span",null,h(t.$t("tooltip.filter_library")),1)]),_:1}),e.showAlbumArtistsOnlyFilter?(f(),E(P,{key:0,location:"bottom"},{activator:u(({props:a})=>[s(B,A(a,{icon:"",variant:"plain",onClick:he}),{default:u(()=>[s(x,{icon:M.value?"mdi-account-music":"mdi-account-music-outline"},null,8,["icon"])]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.album_artist_filter")),1)]),_:1})):_("",!0),s(P,{location:"bottom"},{activator:u(({props:a})=>[s(B,A(a,{icon:"",variant:"plain",onClick:c[0]||(c[0]=w=>_e())}),{default:u(()=>[s(_t,{"model-value":e.updateAvailable,color:"error",dot:""},{default:u(()=>[s(x,{icon:"mdi-refresh"})]),_:1},8,["model-value"])]),_:2},1040)]),default:u(()=>[e.updateAvailable?(f(),$("span",Nt,h(t.$t("tooltip.refresh_new_content")),1)):(f(),$("span",Ft,h(t.$t("tooltip.refresh")),1))]),_:1}),e.sortKeys.length>1?(f(),E(ht,{key:1,modelValue:T.value,"onUpdate:modelValue":c[1]||(c[1]=a=>T.value=a),location:"bottom end","close-on-content-click":!0},{activator:u(({props:a})=>[s(P,{location:"bottom"},{activator:u(({props:w})=>[s(B,A({icon:""},o,{variant:"plain"}),{default:u(()=>[s(x,A(A(a,w),{icon:"mdi-sort"}),null,16)]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.sort_options")),1)]),_:2},1024)]),default:u(()=>[s(yt,null,{default:u(()=>[s(vt,null,{default:u(()=>[(f(!0),$(te,null,ae(e.sortKeys,a=>(f(),$("div",{key:a},[s(gt,{onClick:w=>Ve(a)},{append:u(()=>[I.value==a?(f(),E(x,{key:0,icon:"mdi-check"})):_("",!0)]),default:u(()=>[s(bt,null,{default:u(()=>[U(h(t.$t("sort."+a)),1)]),_:2},1024)]),_:2},1032,["onClick"]),s(kt)]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])):_("",!0),s(P,{location:"bottom"},{activator:u(({props:a})=>[s(B,A(a,{icon:"",variant:"plain",onClick:c[2]||(c[2]=w=>pe())}),{default:u(()=>[s(x,{icon:"mdi-magnify"})]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.search")),1)]),_:1}),s(P,{location:"bottom"},{activator:u(({props:a})=>[s(B,A(a,{icon:p.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:c[3]||(c[3]=w=>be())}),null,16,["icon"])]),default:u(()=>[L("span",null,h(t.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1}),s(He,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=a=>S.value=a),items:d.value,"parent-item":e.parentItem,onClear:ke,onDelete:we},null,8,["modelValue","items","parent-item"]),C.value?(f(),E(We,{key:0,id:"searchInput",modelValue:i.value,"onUpdate:modelValue":c[5]||(c[5]=a=>i.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:t.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-left":"15px","margin-right":"15px","margin-top":"10px"},onFocus:c[6]||(c[6]=a=>g.value=!0),onBlur:c[7]||(c[7]=a=>g.value=!1)},null,8,["modelValue","label"])):_("",!0),L("div",Rt,[v.value?(f(),E(it,{key:0,indeterminate:""})):_("",!0),p.value=="panel"?(f(),E(Je,{key:1},{default:u(()=>[(f(!0),$(te,null,ae(l.value,a=>(f(),E(Qe,{key:a.uri,class:qe(`col-${ge(t.$vuetify.display.width)}`)},{default:u(()=>[s(Xe,{item:a,"is-selected":Y(a),"show-checkboxes":O.value,onSelect:W,onMenu:j,onClick:J},null,8,["item","is-selected","show-checkboxes"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),p.value=="list"?(f(),$("div",qt,[s(ee(Ue),{items:l.value,"item-size":60,"key-field":"uri","page-mode":""},{default:u(({item:a})=>[(f(),E(Ke,{key:a.uri,item:a,"show-track-number":e.showTrackNumber,"show-duration":e.showDuration,"show-library":e.showLibrary!==!1&&!b.value,"show-menu":e.showMenu,"show-providers":e.showProviders,"show-checkboxes":O.value,"is-selected":Y(a),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:W,onMenu:j,onClick:J},null,8,["item","show-track-number","show-duration","show-library","show-menu","show-providers","show-checkboxes","is-selected","show-details","parent-item"]))]),_:1},8,["items"])])):_("",!0),s(ee(xt),{onInfinite:Ce}),!v.value&&l.value.length==0?(f(),$("div",Ut,[!v.value&&l.value.length==0&&(i.value||b.value)?(f(),E(le,{key:0,type:"info",color:"grey",title:t.$t("no_content_filter")},{default:u(()=>[i.value?(f(),E(B,{key:0,style:{"margin-top":"15px"},onClick:Ie},{default:u(()=>[U(h(t.$t("try_global_search")),1)]),_:1})):_("",!0)]),_:1},8,["title"])):!v.value&&l.value.length==0?(f(),E(le,{key:1,type:"info"},{default:u(()=>[U(h(t.$t("no_content")),1)]),_:1})):_("",!0)])):_("",!0),s(Vt,{"model-value":d.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:u(()=>[s(B,{color:"primary",variant:"text",onClick:c[8]||(c[8]=a=>S.value=!0)},{default:u(()=>[U(h(t.$t("actions")),1)]),_:1})]),default:u(()=>[L("span",null,h(t.$t("items_selected",[d.value.length])),1)]),_:1},8,["model-value"])])]))}});const ia=wt(Kt,[["__scopeId","data-v-77f04a36"]]);export{ia as I,sa as f};
